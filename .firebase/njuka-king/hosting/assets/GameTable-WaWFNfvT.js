import{R as e,r as a,j as t}from"./game-core-DQeIkAWe.js";import"./react-vendor-RsqJS7wA.js";import"./howler-vendor-CbBpPY6X.js";import"./game-utils-O_Zcs4Xf.js";const s={"A♠":"https://i.ibb.co/7xkX3DBP/ace-of-spades2.png","A♥":"https://i.ibb.co/35B8BckQ/ace-of-hearts.png","A♦":"https://i.ibb.co/Q7vLKGzd/ace-of-diamonds.png","A♣":"https://i.ibb.co/vx789zqQ/ace-of-clubs.png","K♠":"https://i.ibb.co/398YspSR/king-of-spades2.png","K♥":"https://i.ibb.co/9kxNhK2k/king-of-hearts2.png","K♦":"https://i.ibb.co/tphVCgVN/king-of-diamonds2.png","K♣":"https://i.ibb.co/Jj8sbb7c/king-of-clubs2.png","Q♠":"https://i.ibb.co/Df4rqCWy/queen-of-spades2.png","Q♥":"https://i.ibb.co/7NkjSWQr/queen-of-hearts2.png","Q♦":"https://i.ibb.co/SwK6jMqx/queen-of-diamonds2.png","Q♣":"https://i.ibb.co/SwBy5qF7/queen-of-clubs2.png","J♠":"https://i.ibb.co/NdTVnL3k/jack-of-spades2.png","J♥":"https://i.ibb.co/PGQwd0Bx/jack-of-hearts2.png","J♦":"https://i.ibb.co/HL2JdQzN/jack-of-diamonds2.png","J♣":"https://i.ibb.co/SwC4DSyV/jack-of-clubs2.png","10♠":"https://i.ibb.co/Q3gTw393/10-of-spades.png","10♥":"https://i.ibb.co/ch0S4v6d/10-of-hearts.png","10♦":"https://i.ibb.co/rGhvXcQ0/10-of-diamonds.png","10♣":"https://i.ibb.co/27WWR0RC/10-of-clubs.png","9♠":"https://i.ibb.co/ynrRZpdf/9-of-spades.png","9♥":"https://i.ibb.co/VYjD94NT/9-of-hearts.png","9♦":"https://i.ibb.co/Z3C0k19/9-of-diamonds.png","9♣":"https://i.ibb.co/MyCtXBzK/9-of-clubs.png","8♠":"https://i.ibb.co/p6cMtzSL/8-of-spades.png","8♥":"https://i.ibb.co/DfMDbGs1/8-of-hearts.png","8♦":"https://i.ibb.co/PR1P7W3/8-of-diamonds.png","8♣":"https://i.ibb.co/DSNkX0V/8-of-clubs.png","7♠":"https://i.ibb.co/3YGzcP6B/7-of-spades.png","7♥":"https://i.ibb.co/RkMZCPg0/7-of-hearts.png","7♦":"https://i.ibb.co/PGBBLCjc/7-of-diamonds.png","7♣":"https://i.ibb.co/Zp9RgpJB/7-of-clubs.png","6♠":"https://i.ibb.co/hJrcyLRB/6-of-spades.png","6♥":"https://i.ibb.co/LzVt9rp5/6-of-hearts.png","6♦":"https://i.ibb.co/4RCGvb87/6-of-diamonds.png","6♣":"https://i.ibb.co/LDWSqJVh/6-of-clubs.png","5♠":"https://i.ibb.co/274Cy2FS/5-of-spades.png","5♥":"https://i.ibb.co/G4ksQ9nr/5-of-hearts.png","5♦":"https://i.ibb.co/tGHPrkB/5-of-diamonds.png","5♣":"https://i.ibb.co/RGs6VwSx/5-of-clubs.png","4♠":"https://i.ibb.co/Dg1727gc/4-of-spades.png","4♥":"https://i.ibb.co/3mYLwTcJ/4-of-hearts.png","4♦":"https://i.ibb.co/hxCkckC3/4-of-diamonds.png","4♣":"https://i.ibb.co/dZvG32N/4-of-clubs.png","3♠":"https://i.ibb.co/6R0gW7Z7/3-of-spades.png","3♥":"https://i.ibb.co/dw5fs4kS/3-of-hearts.png","3♦":"https://i.ibb.co/RpdFmS3X/3-of-diamonds.png","3♣":"https://i.ibb.co/v604KYky/3-of-clubs.png","2♠":"https://i.ibb.co/wrJhGjjf/2-of-spades.png","2♥":"https://i.ibb.co/vC7D20SR/2-of-hearts.png","2♦":"https://i.ibb.co/kgb1jzxT/2-of-diamonds.png","2♣":"https://i.ibb.co/xqF5KThJ/2-of-clubs.png"},i=e.memo(function({value:e,suit:i,onClick:n,disabled:r,facedown:l=!1,className:o="",highlight:c=!1,small:d=!1,style:p={},selected:h=!1,...b}){const[g,u]=a.useState(!1),[m,f]=a.useState(0),v=s[e+i];if(l)return t.jsx("div",{className:`card facedown ${o} ${d?"small-card":""}`,style:p,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),role:"img","aria-label":"Facedown card",...b,children:t.jsx("div",{className:"card-back"})});const y="♥"===i||"♦"===i?"red":"black",x=`${e} of ${i}${h?", selected":""}${c?", winning card":""}`;return t.jsx("div",{className:`card ${y} ${o} ${c?"highlight-card":""} ${d?"small-card":""} ${g?"card-hover":""} ${h?"card-selected":""}`,onClick:r?void 0:n,onTouchStart:e=>{f(e.touches[0].clientX)},onTouchEnd:e=>{if(!n||r)return;const a=e.changedTouches[0].clientX;Math.abs(m-a)>30&&n()},onKeyDown:e=>{n&&!r&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n()))},style:r?{opacity:.7,cursor:"not-allowed",...p}:p,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),role:"button",tabIndex:r?-1:0,"aria-label":x,"aria-pressed":h,"aria-disabled":r,...b,children:t.jsx("div",{className:"card-inner",children:v?t.jsxs("picture",{children:[t.jsx("source",{srcSet:v.replace(".png",".webp"),type:"image/webp"}),t.jsx("source",{srcSet:v.replace(".png",".avif"),type:"image/avif"}),t.jsx("img",{src:v,alt:`${e} of ${i}`,className:"card-face-image",loading:"lazy",decoding:"async"})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"card-value",children:e}),t.jsx("span",{className:"card-suit",children:i})]})})})}),n=({state:e,playerName:s,onDiscard:n,onDraw:r,loadingStates:l,playSound:o})=>{const[c,d]=a.useState(null),[p,h]=a.useState(!1),[b,g]=a.useState(null),[u,m]=a.useState(null),[f,v]=a.useState(!1),[y,x]=a.useState([]),[j,w]=a.useState(!1),$=e.players.find(e=>e?.name===s),k=e.current_player??0,N=e.players[k],S=e.game_over;if(a.useEffect(()=>{const e=setTimeout(()=>{h(!0)},3e3);return()=>clearTimeout(e)},[]),a.useEffect(()=>{e?.current_player!==e?.players.findIndex(e=>e?.name===s)&&(h(!1),d(null),g(null),m(null),w(!1))},[e,s]),a.useEffect(()=>{e&&!S&&e.deck.length>0&&0===$?.hand.length&&(v(!0),o("shuffle"),setTimeout(()=>{v(!1);const e=$?.hand.length||0;e>0&&(x(new Array(e).fill(!0)),setTimeout(()=>x([]),250*e+2200))},(window.innerWidth,2e3)))},[e?.id,S,e,$?.hand.length,o]),!$||!N)return t.jsx("div",{className:"error",children:"Player data not available"});const C=e.players.findIndex(e=>e?.name===s),_=(()=>{const a=e.players,t=C;if(-1===t)return{top:null,left:null,right:null,bottom:null};const s=a[t],i=a.filter((e,a)=>a!==t);return{top:i[0]||null,left:i[1]||null,right:i[2]||null,bottom:s}})(),D=a=>S&&e.winner===a.name,P=()=>{o("draw"),navigator.vibrate&&navigator.vibrate([80,30,80]),w(!0),r(),setTimeout(()=>{w(!1)},window.innerWidth<=768?1800:1400)},R=!l.drawing&&N.name===s&&!S&&!e.has_drawn;return t.jsxs("div",{className:"poker-table",children:[t.jsxs("div",{id:"game-announcements",role:"status","aria-live":"polite","aria-atomic":"true",className:"sr-only",style:{position:"absolute",left:"-10000px",width:"1px",height:"1px",overflow:"hidden"},children:[S&&e.winner&&`Game over! ${e.winner} wins!`,!S&&N.name===s&&!e.has_drawn&&"It's your turn. Draw a card from the deck.",!S&&N.name===s&&e.has_drawn&&"Select a card to discard.",!S&&N.name!==s&&`${N.name} is playing.`]}),_.top&&t.jsxs("div",{className:"player-seat top "+(k===e.players.findIndex(e=>e.name===_.top?.name)?"active":""),role:"region","aria-label":`Player ${_.top.name}${_.top.is_cpu?" (CPU)":""}${e.current_player===e.players.findIndex(e=>e.name===_.top?.name)?", current turn":""}`,children:[t.jsxs("h3",{children:[_.top.name,_.top.is_cpu&&" (CPU)"]}),t.jsx("div",{className:"hand horizontal","aria-label":`${_.top.name}'s hand with ${_.top.hand.length} cards`,children:_.top.hand.map((e,a)=>t.jsx(i,{facedown:!S,value:e.value,suit:e.suit,small:!0,highlight:D(_.top)},`top-${a}`))})]}),_.left&&t.jsxs("div",{className:"player-seat left "+(k===e.players.findIndex(e=>e.name===_.left?.name)?"active":""),role:"region","aria-label":`Player ${_.left.name}${_.left.is_cpu?" (CPU)":""}${e.current_player===e.players.findIndex(e=>e.name===_.left?.name)?", current turn":""}`,children:[t.jsxs("h3",{children:[_.left.name,_.left.is_cpu&&" (CPU)"]}),t.jsx("div",{className:"hand horizontal","aria-label":`${_.left.name}'s hand with ${_.left.hand.length} cards`,children:_.left.hand.map((e,a)=>t.jsx(i,{facedown:!S,value:e.value,suit:e.suit,small:!0,highlight:D(_.left)},`left-${a}`))})]}),_.right&&t.jsxs("div",{className:"player-seat right "+(k===e.players.findIndex(e=>e.name===_.right?.name)?"active":""),role:"region","aria-label":`Player ${_.right.name}${_.right.is_cpu?" (CPU)":""}${e.current_player===e.players.findIndex(e=>e.name===_.right?.name)?", current turn":""}`,children:[t.jsxs("h3",{children:[_.right.name,_.right.is_cpu&&" (CPU)"]}),t.jsx("div",{className:"hand horizontal","aria-label":`${_.right.name}'s hand with ${_.right.hand.length} cards`,children:_.right.hand.map((e,a)=>t.jsx(i,{facedown:!S,value:e.value,suit:e.suit,small:!0,highlight:D(_.right)},`right-${a}`))})]}),t.jsxs("div",{className:"table-center",children:[t.jsxs("div",{className:`deck-area ${p?"deck-highlight":""} ${f?"deck-shuffling":""}`,onClick:R?P:void 0,role:"button",tabIndex:R?0:-1,"aria-label":`Deck with ${e.deck?.length??0} cards remaining${R?", click to draw a card":""}`,onKeyDown:e=>{!R||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),P())},children:[t.jsx("div",{className:"deck-count","aria-hidden":"true",children:e.deck?.length??0}),(()=>{const a=e.players[e.current_player]?.name;return a===s&&!e.has_drawn&&!S})()&&t.jsx("div",{className:"tutorial-prompt",role:"status","aria-live":"polite",children:"Pick a card"}),t.jsx(i,{facedown:!0,value:"",suit:"",className:`${j||l.drawing?"card-drawing":""} ${f?"card-shuffling":""}`,style:{cursor:R?"pointer":"default"}})]}),t.jsx("div",{className:"discard-area",role:"region","aria-label":"Discard pile",children:e.pot?.length>0?t.jsx(i,{...e.pot[e.pot.length-1],className:"discard-top"}):t.jsx("div",{className:"discard-empty","aria-label":"Empty discard pile",children:"Empty"})})]}),t.jsxs("div",{className:"player-seat bottom "+(k===C?"active":""),role:"region","aria-label":"Your hand"+(e.current_player===C?", current turn":""),children:[t.jsx("h4",{className:"player-name",children:$.name}),t.jsx("div",{className:"hand","aria-label":`Your hand with ${$.hand?.length||0} cards`,children:$.hand?.map((a,s)=>{const r=y[s]||!1,p=r?`deal-delay-${Math.min(s+1,7)}`:"";return t.jsx(i,{...a,onClick:()=>(e=>{if(c===e){const a=document.querySelector(`[data-card-index="${e}"]`);if(a&&$){const t=a.getBoundingClientRect(),s=$.hand[e];o("discard"),navigator.vibrate&&navigator.vibrate([100,50,100]),m({card:s,position:{x:t.left,y:t.top}}),g(e);const i=window.innerWidth<=768?1800:1200;setTimeout(()=>{n(e),g(null),m(null)},i)}d(null)}else d(e),navigator.vibrate&&navigator.vibrate([30,20,30])})(s),disabled:!e.has_drawn||N.is_cpu||N.name!==$.name||l.discarding||null!==b||r,className:`${b===s?"card-discarding":""} ${r?`card-dealing ${p}`:""}`,highlight:D($),selected:c===s,style:{},"data-card-index":s},`you-${s}`)})})]}),u&&t.jsx(i,{...u.card,className:"discard-animation-overlay",style:{left:u.position.x,top:u.position.y,width:"70px",height:"100px"}})]})};export{n as GameTable,n as default};
