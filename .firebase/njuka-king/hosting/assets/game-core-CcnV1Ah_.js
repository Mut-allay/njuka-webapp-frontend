const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GameTable-CIOhe7Uj.js","assets/react-vendor-RsqJS7wA.js","assets/howler-vendor-CbBpPY6X.js","assets/game-utils-CDj6YZUi.js","assets/GameTable-JJXt5KYL.css","assets/game-components-yfxTmQA3.js","assets/game-components-ldK6loKu.css"])))=>i.map(i=>d[i]);
import{r as e,g as n}from"./react-vendor-RsqJS7wA.js";import{r as a}from"./howler-vendor-CbBpPY6X.js";import{a as t,c as s}from"./game-utils-CDj6YZUi.js";var r,o,i={exports:{}},l={};var c=(o||(o=1,i.exports=function(){if(r)return l;r=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function a(n,a,t){var s=null;if(void 0!==t&&(s=""+t),void 0!==a.key&&(s=""+a.key),"key"in a)for(var r in t={},a)"key"!==r&&(t[r]=a[r]);else t=a;return a=t.ref,{$$typeof:e,type:n,key:s,ref:void 0!==a?a:null,props:t}}return l.Fragment=n,l.jsx=a,l.jsxs=a,l}()),i.exports),d=e();const h=n(d);var u=a();
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m=e=>{const n=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,a)=>a?a.toUpperCase():n.toLowerCase()))(e);return n.charAt(0).toUpperCase()+n.slice(1)},y=(...e)=>e.filter((e,n,a)=>Boolean(e)&&""!==e.trim()&&a.indexOf(e)===n).join(" ").trim(),p=e=>{for(const n in e)if(n.startsWith("aria-")||"role"===n||"title"===n)return!0};
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var w={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=d.forwardRef(({color:e="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:t,className:s="",children:r,iconNode:o,...i},l)=>d.createElement("svg",{ref:l,...w,width:n,height:n,stroke:e,strokeWidth:t?24*Number(a)/Number(n):a,className:y("lucide",s),...!r&&!p(i)&&{"aria-hidden":"true"},...i},[...o.map(([e,n])=>d.createElement(e,n)),...Array.isArray(r)?r:[r]])),x=(e,n)=>{const a=d.forwardRef(({className:a,...t},s)=>{return d.createElement(j,{ref:s,iconNode:n,className:y(`lucide-${r=m(e),r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,a),...t});var r});return a.displayName=m(e),a},b=x("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),g=x("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]),f=x("bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),v=x("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),k=x("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),N=x("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),C=x("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),E=x("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),S=x("volume-x",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),P={},T=function(e,n,a){let t=Promise.resolve();if(n&&n.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");t=e(n.map(e=>{if((e=function(e){return"/"+e}(e))in P)return;P[e]=!0;const n=e.endsWith(".css"),a=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const t=document.createElement("link");return t.rel=n?"stylesheet":"modulepreload",n||(t.as="script"),t.crossOrigin="",t.href=e,s&&t.setAttribute("nonce",s),document.head.appendChild(t),n?new Promise((n,a)=>{t.addEventListener("load",n),t.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=e,window.dispatchEvent(n),!n.defaultPrevented)throw e}return t.then(n=>{for(const e of n||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},$=({isVisible:e,message:n="Loading...",showSpinner:a=!0})=>(d.useEffect(()=>{if(e)return t(n,"polite"),document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}},[e,n]),e?c.jsx("div",{className:"loading-overlay",role:"status","aria-live":"polite","aria-label":n,children:c.jsxs("div",{className:"loading-content",children:[a&&c.jsxs("div",{className:"loading-spinner","aria-hidden":"true",children:[c.jsx("div",{className:"spinner-ring"}),c.jsx("div",{className:"spinner-ring"}),c.jsx("div",{className:"spinner-ring"})]}),c.jsx("p",{className:"loading-message",children:n})]})}):null);
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function _(e,n="Loading..."){const a=d.lazy(e);return function(e){return c.jsx(d.Suspense,{fallback:c.jsx($,{isVisible:!0,message:n,showSpinner:!0}),children:c.jsx(a,{...e})})}}const L=_(()=>T(()=>import("./GameTable-CIOhe7Uj.js"),__vite__mapDeps([0,1,2,3,4])),"Loading game table..."),M=_(()=>T(()=>import("./game-components-yfxTmQA3.js").then(e=>e.G),__vite__mapDeps([5,6])),"Loading game results..."),A=_(()=>T(()=>import("./game-components-yfxTmQA3.js").then(e=>e.T),__vite__mapDeps([5,6])),"Loading tutorial..."),O=({isOpen:e,onClose:n,title:a,showCloseButton:r=!0,closeButtonText:o="Close",closeOnOverlayClick:i=!0,closeOnEscape:l=!0,className:h="",contentClassName:u="",focusTrapOptions:m={},children:y,announceOnOpen:p=!0,announcementMessage:w})=>{const j=d.useRef(null),x=d.useRef(null);d.useEffect(()=>{if(e&&j.current&&(x.current=s(j.current,{restoreFocus:!0,...m}),x.current.activate(),p)){t(w||`${a} dialog opened`,"polite")}return()=>{x.current&&(x.current.deactivate(),x.current=null)}},[e,a,p,w,m]);const b=d.useCallback(a=>{e&&l&&"Escape"===a.key&&(a.preventDefault(),n())},[e,l,n]);d.useEffect(()=>{if(e)return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[e,b]);const g=d.useCallback(e=>{i&&e.target===e.currentTarget&&n()},[i,n]),f=d.useCallback(()=>{n()},[n]);return e?c.jsx("div",{className:`modal-overlay ${h}`,onClick:g,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",ref:j,children:c.jsxs("div",{className:`modal-content ${u}`,children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{id:"modal-title",className:"modal-title",children:a}),r&&c.jsxs("button",{type:"button",className:"modal-close-button",onClick:f,"aria-label":`Close ${a} dialog`,children:[c.jsx("span",{"aria-hidden":"true",children:"Ã—"}),c.jsx("span",{className:"sr-only",children:o})]})]}),c.jsx("div",{className:"modal-body",children:y})]})}):null},F=({isOpen:e,onClose:n,title:a="Error",message:t,showRetryButton:s=!1,onRetry:r,retryButtonText:o="Retry"})=>c.jsxs(O,{isOpen:e,onClose:n,title:a,closeButtonText:"OK",className:"error-modal",contentClassName:"error-content",announceOnOpen:!0,announcementMessage:`${a}: ${t}`,children:[c.jsxs("div",{className:"error-message",children:[c.jsx("div",{className:"error-icon","aria-hidden":"true",children:"âš ï¸"}),c.jsx("p",{children:t})]}),c.jsxs("div",{className:"error-actions",children:[s&&r&&c.jsx("button",{className:"error-retry-button",onClick:()=>{r&&r(),n()},autoFocus:!0,children:o}),c.jsx("button",{className:"error-close-button",onClick:n,autoFocus:!s,children:"OK"})]})]}),R="https://njuka-webapp-backend.onrender.com",I=async(e,n,a=1,t=4)=>{try{const s=await fetch(`${R}/new_game?mode=${e}&player_name=${encodeURIComponent(n)}&cpu_count=${a}&max_players=${t}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.message||"Failed to create game")}return s.json()}catch(s){throw new Error("Network error. Please check your connection.")}},z=async(e,n)=>{try{const a=await fetch(`${R}/join_game?game_id=${e}&player_name=${encodeURIComponent(n)}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.message||"Failed to join game")}return a.json()}catch(a){throw new Error("Network error. Please check your connection.")}},H=async e=>{try{const n=await fetch(`${R}/game/${e}/draw`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.message||"Failed to draw card")}return n.json()}catch{throw new Error("Failed to connect to server. Please try again.")}},U=async(e,n)=>{try{const a=await fetch(`${R}/game/${e}/discard?card_index=${n}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.message||"Failed to discard card")}return a.json()}catch{throw new Error("Failed to connect to server. Please try again.")}},q=async()=>{try{return(await fetch(`${R}/health`)).ok}catch{return!1}},B=async()=>{try{const e=await fetch(`${R}/lobby/list`);if(!e.ok){if(404===e.status)return[];throw new Error("Failed to fetch lobbies")}return(await e.json()).lobbies||[]}catch(e){return[]}},G=async(e,n)=>{try{const a=await fetch(`${R}/lobby/create?host_name=${encodeURIComponent(e)}&max_players=${n}`,{method:"POST"});if(!a.ok)throw new Error("Failed to create lobby");return a.json()}catch(a){throw new Error("Failed to create lobby")}},D=async(e,n)=>{try{const a=await fetch(`${R}/lobby/join?lobby_id=${e}&player_name=${encodeURIComponent(n)}`,{method:"POST"});if(!a.ok)throw new Error("Failed to join lobby");return a.json()}catch(a){throw new Error("Failed to join lobby")}},V=async e=>{try{const n=await fetch(`${R}/lobby/${e}`);if(404===n.status)return null;if(!n.ok)throw new Error("Failed to fetch lobby details");return n.json()}catch(n){throw new Error("Failed to fetch lobby details")}},W=async(e,n)=>{try{if(!(await fetch(`${R}/lobby/cancel?lobby_id=${e}&host_name=${encodeURIComponent(n)}`,{method:"POST"})).ok)throw new Error("Failed to cancel lobby")}catch(a){throw new Error("Failed to cancel lobby")}},K=({onSelectMode:e,playerName:n,setPlayerName:a})=>c.jsxs("div",{className:"page-container",children:[c.jsxs("div",{className:"welcome-section",children:[c.jsx("h2",{children:"Welcome to Njuka King!"}),c.jsx("p",{children:"Choose your game mode to start playing"})]}),c.jsxs("div",{className:"new-game-form",children:[c.jsxs("label",{children:["Your Name:",c.jsx("input",{type:"text",value:n,onChange:e=>{const n=e.target.value.trim();n.length<=20&&a(n)},placeholder:"Enter your name (2-20 chars)",minLength:2,maxLength:20,required:!0})]}),c.jsxs("div",{className:"game-mode-buttons",children:[c.jsxs("button",{className:"mode-button multiplayer-button",onClick:()=>e("multiplayer"),disabled:!n.trim(),children:[c.jsx(C,{size:32}),c.jsx("span",{children:"Multiplayer"}),c.jsx("p",{children:"Play with friends online"})]}),c.jsxs("button",{className:"mode-button cpu-button",onClick:()=>e("cpu"),disabled:!n.trim(),children:[c.jsx(f,{size:32}),c.jsx("span",{children:"VS CPU"}),c.jsx("p",{children:"Play against computer opponents"})]})]})]})]}),J=({onBack:e,playerName:n,numPlayers:a,setNumPlayers:t,onCreateLobby:s,onJoinLobby:r,lobbies:o,loadingStates:i,onRefreshLobbies:l})=>c.jsxs("div",{className:"page-container",children:[c.jsxs("div",{className:"page-header",children:[c.jsxs("button",{onClick:e,className:"back-button",children:[c.jsx(b,{size:20}),"Back"]}),c.jsx("h2",{children:"Multiplayer Lobby"})]}),c.jsxs("div",{className:"multiplayer-content",children:[c.jsxs("div",{className:"create-lobby-section",children:[c.jsx("h3",{children:"Create New Game"}),c.jsxs("label",{children:["Max Players:",c.jsxs("select",{value:a,onChange:e=>t(Number(e.target.value)),children:[c.jsx("option",{value:2,children:"2 Players"}),c.jsx("option",{value:3,children:"3 Players"}),c.jsx("option",{value:4,children:"4 Players"}),c.jsx("option",{value:5,children:"5 Players"}),c.jsx("option",{value:6,children:"6 Players"})]})]}),c.jsx("button",{onClick:s,disabled:i.starting||!n.trim(),className:"create-lobby-btn",children:i.starting?"Creating...":"Create New Game"})]}),c.jsx("div",{className:"divider",children:c.jsx("span",{children:"OR"})}),c.jsxs("div",{className:"join-lobby-section",children:[c.jsxs("div",{className:"lobby-header",children:[c.jsx("h3",{children:"Available Lobbies"}),c.jsx("button",{onClick:l,className:"refresh-btn",children:"Refresh"})]}),c.jsx("div",{className:"lobby-list",children:0===o.length?c.jsxs("div",{className:"no-lobbies",children:[c.jsx("p",{children:"No games available right now."}),c.jsx("p",{children:"Create a new game to start playing!"})]}):o.map(e=>c.jsxs("div",{className:"lobby-item",children:[c.jsxs("div",{className:"lobby-info",children:[c.jsxs("h4",{children:["Host: ",e.host]}),c.jsxs("p",{children:["Players: ",e.players.length,"/",e.max_players]}),c.jsx("div",{className:"player-list-preview",children:e.players.map(n=>c.jsxs("span",{className:"player-tag",children:[n,n===e.host&&" ðŸ‘‘"]},n))}),c.jsxs("p",{className:"lobby-created",children:["Created: ",new Date(e.created_at).toLocaleString()]})]}),c.jsx("button",{onClick:()=>r(e.id),disabled:e.players.length>=e.max_players||i.joining,className:"join-lobby-btn",children:i.joining?"Joining...":"Join Game"})]},e.id))})]})]})]}),Y=({onBack:e,onStartGame:n,numCPU:a,setNumCPU:t,loadingStates:s})=>c.jsxs("div",{className:"page-container",children:[c.jsxs("div",{className:"page-header",children:[c.jsxs("button",{onClick:e,className:"back-button",children:[c.jsx(b,{size:20}),"Back"]}),c.jsx("h2",{children:"Play vs CPU"})]}),c.jsx("div",{className:"cpu-game-content",children:c.jsxs("div",{className:"cpu-options",children:[c.jsx("h3",{children:"Choose Your Opponents"}),c.jsx("p",{children:"Select how many CPU players you want to face"}),c.jsxs("div",{className:"cpu-selection",children:[c.jsx("label",{children:"Number of CPU Players:"}),c.jsx("div",{className:"cpu-buttons",children:[1,2,3].map(e=>c.jsxs("button",{onClick:()=>t(e),className:"cpu-count-btn "+(a===e?"selected":""),children:[e," CPU"]},e))})]}),c.jsxs("div",{className:"difficulty-info",children:[c.jsx("h4",{children:"CPU Difficulty: Smart"}),c.jsx("p",{children:"CPU players will make strategic decisions and try to win!"})]}),c.jsx("button",{onClick:n,disabled:s.starting,className:"start-cpu-game-btn",children:s.starting?"Starting Game...":`Start Game vs ${a} CPU`})]})})]}),Z=({onBack:e})=>c.jsxs("div",{className:"page-container",children:[c.jsxs("div",{className:"page-header",children:[c.jsxs("button",{onClick:e,className:"back-button",children:[c.jsx(b,{size:20}),"Back"]}),c.jsx("h2",{children:"How to Play Njuka King"})]}),c.jsxs("div",{className:"rules-content",children:[c.jsxs("section",{className:"rules-section",children:[c.jsx("h3",{children:"ðŸŽ¯ Objective"}),c.jsx("p",{children:"Be the first player to create a winning hand of exactly 4 cards."})]}),c.jsxs("section",{className:"rules-section",children:[c.jsx("h3",{children:"ðŸƒ Winning Hand"}),c.jsx("p",{children:"A winning hand consists of:"}),c.jsxs("ul",{children:[c.jsxs("li",{children:[c.jsx("strong",{children:"One Pair"})," - Two cards of the same rank (e.g., two 8s)"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Two Followers"})," - Two cards in sequential order (e.g., 9 and 10)"]})]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Example:"})," 8â™¥, 8â™ , 9â™£, 10â™¦ (pair of 8s + 9,10 sequence)"]})]}),c.jsxs("section",{className:"rules-section",children:[c.jsx("h3",{children:"ðŸŽ® How to Play"}),c.jsxs("ol",{children:[c.jsxs("li",{children:[c.jsx("strong",{children:"Draw Phase:"})," On your turn, draw one card from the deck"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Discard Phase:"})," Choose one card from your hand to discard"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Win Check:"})," If you have a winning hand, the game ends and you win!"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Continue:"})," Play passes to the next player"]})]})]}),c.jsxs("section",{className:"rules-section",children:[c.jsx("h3",{children:"ðŸ“± Controls"}),c.jsxs("ul",{children:[c.jsxs("li",{children:[c.jsx("strong",{children:"Draw Card:"})," Tap the deck to draw a card"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Select Card:"})," Tap a card in your hand to select it"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Discard:"})," Tap the selected card again to discard it"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Mobile Gestures:"})," Swipe cards left/right to discard quickly"]})]})]}),c.jsxs("section",{className:"rules-section",children:[c.jsx("h3",{children:"ðŸ’¡ Pro Tips"}),c.jsxs("ul",{children:[c.jsx("li",{children:"Watch what other players discard - you might be able to use those cards!"}),c.jsx("li",{children:"Sometimes you can win with just 3 cards if the top discard pile card completes your hand"}),c.jsx("li",{children:"Keep track of which cards have been played to know what's still in the deck"}),c.jsx("li",{children:"Don't hold onto cards too long - be ready to adapt your strategy"})]})]}),c.jsxs("section",{className:"rules-section",children:[c.jsx("h3",{children:"ðŸŽµ Audio & Accessibility"}),c.jsxs("ul",{children:[c.jsx("li",{children:"Sound effects play for all game actions"}),c.jsx("li",{children:"Haptic feedback on mobile devices for better gameplay feel"}),c.jsx("li",{children:"Screen reader compatible with proper ARIA labels"}),c.jsx("li",{children:"Toggle sounds on/off in settings"})]})]}),c.jsxs("section",{className:"rules-section",children:[c.jsx("h3",{children:"ðŸ† Winning"}),c.jsx("p",{children:"The first player to achieve a winning hand wins the game! The winning hand will be displayed for all players to see."})]})]})]}),Q=({quitGameToMenu:e,soundsEnabled:n,toggleSounds:a,playSound:t,onShowRules:s,currentPage:r,onGoHome:o})=>{const[i,l]=d.useState(!1),[h,u]=d.useState(!1),m=e=>{t("button"),navigator.vibrate&&navigator.vibrate([40,20,40]),e()},y=()=>{l(!i),u(!1)},p=()=>{u(!h),l(!1)};return c.jsxs("div",{className:"enhanced-bottom-menu",children:[i&&c.jsx("div",{className:"expanded-panel settings-panel",children:c.jsxs("button",{onClick:()=>m(a),className:"panel-button",children:[n?c.jsx(E,{size:20}):c.jsx(S,{size:20}),"Sound ",n?"ON":"OFF"]})}),h&&c.jsx("div",{className:"expanded-panel info-panel",children:c.jsxs("button",{onClick:()=>m(s),className:"panel-button",children:[c.jsx(g,{size:20}),"Rules"]})}),c.jsxs("div",{className:"main-menu-bar",children:[c.jsxs("button",{onClick:()=>m(o),className:"menu-button",children:[c.jsx(v,{size:20}),c.jsx("span",{children:"Home"})]}),c.jsxs("button",{onClick:()=>m(y),className:"menu-button "+(i?"active":""),children:[c.jsx(N,{size:20}),c.jsx("span",{children:"Settings"})]}),c.jsxs("button",{onClick:()=>m(p),className:"menu-button "+(h?"active":""),children:[c.jsx(k,{size:20}),c.jsx("span",{children:"Info"})]}),e&&c.jsx("button",{onClick:()=>m(e),className:"menu-button quit-button",children:c.jsx("span",{children:"Quit"})})]})]})};function X(){const[e,n]=d.useState("home"),[a,t]=d.useState("Player"),[s,r]=d.useState(4),[o,i]=d.useState(1),[l,h]=d.useState([]),[m,y]=d.useState(null),[p,w]=d.useState(null),[j,x]=d.useState(null),[b,g]=d.useState(null),[f,v]=d.useState(!0),[k,N]=d.useState({drawing:!1,discarding:!1,joining:!1,starting:!1,cpuMoving:!1}),{playSound:C,soundsEnabled:E,toggleSounds:S,enableAudio:P}=(()=>{const[e,n]=d.useState(!0),[a,t]=d.useState(null),s=d.useCallback(async(e,n,s="sine")=>{if("undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext))try{let r=a;r||(r=new(window.AudioContext||window.webkitAudioContext),t(r)),"suspended"===r.state&&await r.resume();const o=r.createOscillator(),i=r.createGain();o.connect(i),i.connect(r.destination),o.frequency.setValueAtTime(e,r.currentTime),o.type=s,i.gain.setValueAtTime(.05,r.currentTime),i.gain.exponentialRampToValueAtTime(.001,r.currentTime+n),o.start(r.currentTime),o.stop(r.currentTime+n)}catch(b){}},[a]),r=d.useMemo(()=>({draw:new u.Howl({src:["/sounds/draw.mp3","/sounds/draw.wav"],volume:.3,html5:!0,onloaderror:()=>{}}),discard:new u.Howl({src:["/sounds/discard.mp3","/sounds/discard.wav"],volume:.4,html5:!0,onloaderror:()=>{}}),win:new u.Howl({src:["/sounds/win.mp3","/sounds/win.wav"],volume:.5,html5:!0,onloaderror:()=>{}}),button:new u.Howl({src:["/sounds/button.mp3","/sounds/button.wav"],volume:.2,html5:!0,onloaderror:()=>{}}),shuffle:new u.Howl({src:["/sounds/shuffle.mp3","/sounds/shuffle.wav"],volume:.3,html5:!0,onloaderror:()=>{}})}),[]),o=d.useCallback(async e=>{try{switch(e){case"draw":await s(800,.2,"sine");break;case"discard":await s(400,.3,"sawtooth");break;case"shuffle":setTimeout(async()=>await s(300,.1,"square"),0),setTimeout(async()=>await s(350,.1,"square"),100),setTimeout(async()=>await s(320,.1,"square"),200);break;case"win":await s(523,.4,"sine"),setTimeout(async()=>await s(659,.4,"sine"),200),setTimeout(async()=>await s(784,.6,"sine"),400);break;case"button":await s(1e3,.1,"square")}}catch(n){}},[s]),i=d.useCallback(async n=>{if(e)try{const e=r[n];if("loaded"===e.state())try{e.play()}catch(a){await o(n)}else await o(n)}catch(b){await o(n)}},[e,r,o]),l=d.useCallback(()=>{n(e=>!e)},[]),c=d.useCallback(async()=>{if("undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext))try{let e=a;e||(e=new(window.AudioContext||window.webkitAudioContext),t(e)),"suspended"===e.state&&await e.resume()}catch(b){}},[a]);return{playSound:i,soundsEnabled:e,toggleSounds:l,enableAudio:c}})();d.useEffect(()=>{const e=async()=>{await P(),document.removeEventListener("touchstart",e),document.removeEventListener("click",e),document.removeEventListener("keydown",e)};return document.addEventListener("touchstart",e,{once:!0}),document.addEventListener("click",e,{once:!0}),document.addEventListener("keydown",e,{once:!0}),()=>{document.removeEventListener("touchstart",e),document.removeEventListener("click",e),document.removeEventListener("keydown",e)}},[P]),d.useEffect(()=>{if(!j||!f)return;let e,n=3,a=2e3;const t=async()=>{try{const t=await fetch(`${R}/game/${j}`);if(!t.ok){if(404===t.status)return g("Game not found or expired. Returning to main menu."),w(null),x(null),void clearInterval(e);throw new Error("Network response was not ok")}const s=await t.json();w(s),n=3,a=2e3}catch(s){n--,a=Math.min(1.5*a,1e4),n<=0?(g("Connection lost. Trying to reconnect..."),clearInterval(e),setTimeout(async()=>{const s=await q();v(s),s&&(a=2e3,e=setInterval(t,a),t()),n=3},5e3)):(clearInterval(e),e=setInterval(t,a))}};return e=setInterval(t,a),t(),()=>clearInterval(e)},[j,f]),d.useEffect(()=>{if(!p||p.game_over||!f)return;const e=p.players[p.current_player],n=e.name===a;if(e?.is_cpu&&!n&&!k.cpuMoving){N(e=>({...e,cpuMoving:!0}));(async()=>{try{await new Promise(e=>setTimeout(e,1e3)),C("draw");const n=await H(p.id);w(n),await new Promise(e=>setTimeout(e,1e3));const a=n.players.find(n=>n.name===e.name);if(a&&a.hand.length>0){const e=Math.floor(Math.random()*a.hand.length);C("discard");const t=await U(n.id,e);w(t)}else{const e=await fetch(`${R}/game/${p.id}`).then(e=>e.json());w(e)}}catch(n){try{const e=await fetch(`${R}/game/${p.id}`).then(e=>e.json());w(e)}catch(a){}}finally{N(e=>({...e,cpuMoving:!1}))}})()}},[p,a,f,k.cpuMoving,C]),d.useEffect(()=>{if("multiplayer"!==e||!f)return;const n=setInterval(()=>{B().then(h).catch(()=>{})},5e3);return()=>clearInterval(n)},[e,f]),d.useEffect(()=>{if(!m||!f)return;const e=setInterval(async()=>{try{const t=await V(m.id);if(null===t)y(null),g("Lobby disappeared. It might have started or expired. Please check available games."),n("home");else if(t.started&&t.game_id)try{const e=await z(t.game_id,a);y(null),x(e.id),w(e)}catch(e){const a=e instanceof Error?e.message:"Failed to join game after lobby started.";g(a),y(null),n("home")}else y(t)}catch(t){const e=t instanceof Error?t.message:"An unexpected error occurred while fetching lobby details.";g(e)}},3e3);return()=>clearInterval(e)},[m,f,a]),d.useEffect(()=>{p&&!p.game_over&&p.players.length>=2&&!p.has_drawn&&p.pot.length},[p]);const T=()=>{w(null),x(null),n("home")},_=()=>{n("home")};return c.jsxs("div",{className:"App",children:[c.jsx("h1",{children:"Njuka King"}),c.jsx(F,{isOpen:!!b,onClose:()=>g(null),message:b||"",showRetryButton:b?.includes("Connection")||b?.includes("Network")||!1,onRetry:()=>window.location.reload(),retryButtonText:"Retry Connection"}),c.jsx($,{isVisible:k.starting||k.joining,message:"Connecting to game server..."}),p?c.jsxs("div",{className:"game-container",children:[c.jsx(L,{state:p,playerName:a,onDiscard:async e=>{N(e=>({...e,discarding:!0})),g(null);try{if(!p)return;const n=await U(p.id,e);w(n),C("discard")}catch(n){g(n.message||"Failed to discard card")}finally{N(e=>({...e,discarding:!1}))}},onDraw:async()=>{N(e=>({...e,drawing:!0})),g(null);try{if(!p)return;const e=await H(p.id);w(e),C("draw")}catch(e){g(e.message||"Failed to draw card")}finally{N(e=>({...e,drawing:!1}))}},loadingStates:k,playSound:C,showTutorial:"tutorial"===e,onCloseTutorial:_}),c.jsx(M,{isOpen:!!p.game_over,onClose:T,winner:p.winner||"Unknown",winnerHand:p.winner_hand,onNewGame:T})]}):m?c.jsxs("div",{className:"lobby-view",children:[c.jsxs("h2",{children:["Lobby: ",m.id]}),c.jsxs("p",{children:["Host: ",m.host]}),c.jsxs("p",{children:["Players: ",m.players.length,"/",m.max_players]}),c.jsxs("div",{className:"player-list",children:[c.jsx("h3",{children:"Players:"}),c.jsx("ul",{children:m.players.map(e=>c.jsxs("li",{children:[e," ",e===a&&"(You)",e===m.host&&" ðŸ‘‘"]},e))})]}),c.jsxs("div",{className:"lobby-actions",children:[m.host===a&&!m.started&&c.jsx("button",{onClick:async()=>{if(m){N(e=>({...e,starting:!0})),g(null);try{await W(m.id,a),y(null),n("home"),B().then(h).catch(()=>h([])),C("button")}catch(e){g(e.message||"Failed to cancel lobby")}finally{N(e=>({...e,starting:!1}))}}},className:"cancel-btn",disabled:k.starting,children:k.starting?"Cancelling...":"Cancel Game"}),c.jsx("button",{onClick:()=>y(null),className:"quit-btn",children:"Leave Lobby"})]})]}):c.jsxs(c.Fragment,{children:["home"===e&&c.jsx(K,{onSelectMode:e=>{"multiplayer"===e?(n("multiplayer"),B().then(h).catch(()=>h([]))):n("cpu")},playerName:a,setPlayerName:t}),"multiplayer"===e&&c.jsx(J,{onBack:()=>n("home"),playerName:a,numPlayers:s,setNumPlayers:r,onCreateLobby:async()=>{N(e=>({...e,starting:!0})),g(null);try{const e=await G(a,s);y(e);const t=await I("multiplayer",a,0,s);x(t.id),w(t),n("game"),C("shuffle")}catch(e){g(e.message||"Failed to create lobby")}finally{N(e=>({...e,starting:!1}))}},onJoinLobby:async e=>{N(e=>({...e,joining:!0})),g(null);try{const t=await V(e);if(!t)throw new Error("Lobby not found");if(t.players.includes(a)&&t.game_id){const e=await z(t.game_id,a);return x(e.id),w(e),n("game"),void C("draw")}const s=await D(e,a);let r;if(y(s),s.game_id)r=await z(s.game_id,a);else{r=await I("multiplayer",s.host,0,s.max_players);for(const e of s.players)e!==s.host&&await z(r.id,e)}x(r.id),w(r),n("game"),C("draw")}catch(t){g(t.message||"Failed to join lobby")}finally{N(e=>({...e,joining:!1}))}},lobbies:l,loadingStates:k,onRefreshLobbies:()=>{B().then(h).catch(()=>g("Failed to refresh lobbies"))}}),"cpu"===e&&c.jsx(Y,{onBack:()=>n("home"),onStartGame:async()=>{N(e=>({...e,starting:!0})),g(null);try{const e=await I("cpu",a,o);x(e.id),w(e),n("game"),C("shuffle")}catch(e){g(e.message||"Failed to create game")}finally{N(e=>({...e,starting:!1}))}},numCPU:o,setNumCPU:i,loadingStates:k}),"rules"===e&&c.jsx(Z,{onBack:()=>n("home")}),"tutorial"===e&&c.jsx(A,{isOpen:!0,onClose:_})]}),c.jsx(Q,{quitGameToMenu:p?T:void 0,soundsEnabled:E,toggleSounds:S,playSound:C,onShowRules:()=>{n("rules")},currentPage:e,onGoHome:()=>{n("home"),y(null),w(null),x(null)}})]})}export{X as A,O as M,h as R,c as j,d as r};
