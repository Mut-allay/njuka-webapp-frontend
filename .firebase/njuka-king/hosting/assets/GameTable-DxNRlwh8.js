import{R as e,r as a,j as s}from"./game-core-RrBAcMx8.js";import"./react-vendor-RsqJS7wA.js";import"./howler-vendor-CbBpPY6X.js";import"./game-utils-CVViNcXd.js";const i={"A♠":"https://i.ibb.co/7xkX3DBP/ace-of-spades2.png","A♥":"https://i.ibb.co/35B8BckQ/ace-of-hearts.png","A♦":"https://i.ibb.co/Q7vLKGzd/ace-of-diamonds.png","A♣":"https://i.ibb.co/vx789zqQ/ace-of-clubs.png","K♠":"https://i.ibb.co/398YspSR/king-of-spades2.png","K♥":"https://i.ibb.co/9kxNhK2k/king-of-hearts2.png","K♦":"https://i.ibb.co/tphVCgVN/king-of-diamonds2.png","K♣":"https://i.ibb.co/Jj8sbb7c/king-of-clubs2.png","Q♠":"https://i.ibb.co/Df4rqCWy/queen-of-spades2.png","Q♥":"https://i.ibb.co/7NkjSWQr/queen-of-hearts2.png","Q♦":"https://i.ibb.co/SwK6jMqx/queen-of-diamonds2.png","Q♣":"https://i.ibb.co/SwBy5qF7/queen-of-clubs2.png","J♠":"https://i.ibb.co/NdTVnL3k/jack-of-spades2.png","J♥":"https://i.ibb.co/PGQwd0Bx/jack-of-hearts2.png","J♦":"https://i.ibb.co/HL2JdQzN/jack-of-diamonds2.png","J♣":"https://i.ibb.co/SwC4DSyV/jack-of-clubs2.png","10♠":"https://i.ibb.co/Q3gTw393/10-of-spades.png","10♥":"https://i.ibb.co/ch0S4v6d/10-of-hearts.png","10♦":"https://i.ibb.co/rGhvXcQ0/10-of-diamonds.png","10♣":"https://i.ibb.co/27WWR0RC/10-of-clubs.png","9♠":"https://i.ibb.co/ynrRZpdf/9-of-spades.png","9♥":"https://i.ibb.co/VYjD94NT/9-of-hearts.png","9♦":"https://i.ibb.co/Z3C0k19/9-of-diamonds.png","9♣":"https://i.ibb.co/MyCtXBzK/9-of-clubs.png","8♠":"https://i.ibb.co/p6cMtzSL/8-of-spades.png","8♥":"https://i.ibb.co/DfMDbGs1/8-of-hearts.png","8♦":"https://i.ibb.co/PR1P7W3/8-of-diamonds.png","8♣":"https://i.ibb.co/DSNkX0V/8-of-clubs.png","7♠":"https://i.ibb.co/3YGzcP6B/7-of-spades.png","7♥":"https://i.ibb.co/RkMZCPg0/7-of-hearts.png","7♦":"https://i.ibb.co/PGBBLCjc/7-of-diamonds.png","7♣":"https://i.ibb.co/Zp9RgpJB/7-of-clubs.png","6♠":"https://i.ibb.co/hJrcyLRB/6-of-spades.png","6♥":"https://i.ibb.co/LzVt9rp5/6-of-hearts.png","6♦":"https://i.ibb.co/4RCGvb87/6-of-diamonds.png","6♣":"https://i.ibb.co/LDWSqJVh/6-of-clubs.png","5♠":"https://i.ibb.co/274Cy2FS/5-of-spades.png","5♥":"https://i.ibb.co/G4ksQ9nr/5-of-hearts.png","5♦":"https://i.ibb.co/tGHPrkB/5-of-diamonds.png","5♣":"https://i.ibb.co/RGs6VwSx/5-of-clubs.png","4♠":"https://i.ibb.co/Dg1727gc/4-of-spades.png","4♥":"https://i.ibb.co/3mYLwTcJ/4-of-hearts.png","4♦":"https://i.ibb.co/hxCkckC3/4-of-diamonds.png","4♣":"https://i.ibb.co/dZvG32N/4-of-clubs.png","3♠":"https://i.ibb.co/6R0gW7Z7/3-of-spades.png","3♥":"https://i.ibb.co/dw5fs4kS/3-of-hearts.png","3♦":"https://i.ibb.co/RpdFmS3X/3-of-diamonds.png","3♣":"https://i.ibb.co/v604KYky/3-of-clubs.png","2♠":"https://i.ibb.co/wrJhGjjf/2-of-spades.png","2♥":"https://i.ibb.co/vC7D20SR/2-of-hearts.png","2♦":"https://i.ibb.co/kgb1jzxT/2-of-diamonds.png","2♣":"https://i.ibb.co/xqF5KThJ/2-of-clubs.png"},t=e.memo(function({value:e,suit:t,onClick:n,disabled:r,facedown:c=!1,className:o="",highlight:l=!1,small:d=!1,style:p={},selected:h=!1,...b}){const[g,u]=a.useState(!1),[m,f]=a.useState(0),v=i[e+t];if(c)return s.jsx("div",{className:`card facedown ${o} ${d?"small-card":""}`,style:p,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),role:"img","aria-label":"Facedown card",...b,children:s.jsx("div",{className:"card-back"})});const y="♥"===t||"♦"===t?"red":"black",x=`${e} of ${t}${h?", selected":""}${l?", winning card":""}`;return s.jsx("div",{className:`card ${y} ${o} ${l?"highlight-card":""} ${d?"small-card":""} ${g?"card-hover":""} ${h?"card-selected":""}`,onClick:r?void 0:n,onTouchStart:e=>{f(e.touches[0].clientX)},onTouchEnd:e=>{if(!n||r)return;const a=e.changedTouches[0].clientX;Math.abs(m-a)>30&&n()},onKeyDown:e=>{n&&!r&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n()))},style:r?{opacity:.7,cursor:"not-allowed",...p}:p,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),role:"button",tabIndex:r?-1:0,"aria-label":x,"aria-pressed":h,"aria-disabled":r,...b,children:s.jsx("div",{className:"card-inner",children:v?s.jsxs("picture",{children:[s.jsx("source",{srcSet:v.replace(".png",".webp"),type:"image/webp"}),s.jsx("source",{srcSet:v.replace(".png",".avif"),type:"image/avif"}),s.jsx("img",{src:v,alt:`${e} of ${t}`,className:"card-face-image",loading:"lazy",decoding:"async"})]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"card-value",children:e}),s.jsx("span",{className:"card-suit",children:t})]})})})}),n=({state:e,playerName:i,onDiscard:n,onDraw:r,loadingStates:c,playSound:o})=>{const[l,d]=a.useState(null),[p,h]=a.useState(!1),[b,g]=a.useState(null),[u,m]=a.useState(null),[f,v]=a.useState(!1),[y,x]=a.useState([]),[j,w]=a.useState(!1),$=e.players.find(e=>e?.name===i),k=e.current_player??0,N=e.players[k],S=e.game_over;if(a.useEffect(()=>{const e=setTimeout(()=>{h(!0)},3e3);return()=>clearTimeout(e)},[]),a.useEffect(()=>{e?.current_player!==e?.players.findIndex(e=>e?.name===i)&&(h(!1),d(null),g(null),m(null),w(!1))},[e,i]),a.useEffect(()=>{e&&!S&&e.deck.length>0&&0===$?.hand.length&&(v(!0),o("shuffle"),setTimeout(()=>{v(!1);const e=$?.hand.length||0;e>0&&(x(new Array(e).fill(!0)),setTimeout(()=>x([]),250*e+2200))},(window.innerWidth,2e3)))},[e?.id,S,e,$?.hand.length,o]),!$||!N)return s.jsx("div",{className:"error",children:"Player data not available"});const C=a=>e.players[a]??{name:"Player",hand:[],is_cpu:!1},P=a=>S&&e.winner===a.name,D=()=>{o("draw"),navigator.vibrate&&navigator.vibrate([80,30,80]),w(!0),r(),setTimeout(()=>{w(!1)},window.innerWidth<=768?1800:1400)},_=!c.drawing&&N.name===i&&!S&&!e.has_drawn;return s.jsxs("div",{className:"poker-table",children:[s.jsxs("div",{id:"game-announcements",role:"status","aria-live":"polite","aria-atomic":"true",className:"sr-only",style:{position:"absolute",left:"-10000px",width:"1px",height:"1px",overflow:"hidden"},children:[S&&e.winner&&`Game over! ${e.winner} wins!`,!S&&N.name===i&&!e.has_drawn&&"It's your turn. Draw a card from the deck.",!S&&N.name===i&&e.has_drawn&&"Select a card to discard.",!S&&N.name!==i&&`${N.name} is playing.`]}),e.players.length>1&&s.jsxs("div",{className:"player-seat top "+(1===k?"active":""),role:"region","aria-label":`Player ${C(1).name}${C(1).is_cpu?" (CPU)":""}${1===k?", current turn":""}`,children:[s.jsxs("h3",{children:[C(1).name,C(1).is_cpu&&" (CPU)"]}),s.jsx("div",{className:"hand horizontal","aria-label":`${C(1).name}'s hand with ${C(1).hand.length} cards`,children:C(1).hand.map((e,a)=>s.jsx(t,{facedown:!S,value:e.value,suit:e.suit,small:!0,highlight:P(C(1))},`top-${a}`))})]}),e.players.length>2&&s.jsxs("div",{className:"player-seat left "+(2===k?"active":""),role:"region","aria-label":`Player ${C(2).name}${C(2).is_cpu?" (CPU)":""}${2===k?", current turn":""}`,children:[s.jsxs("h3",{children:[C(2).name,C(2).is_cpu&&" (CPU)"]}),s.jsx("div",{className:"hand horizontal","aria-label":`${C(2).name}'s hand with ${C(2).hand.length} cards`,children:C(2).hand.map((e,a)=>s.jsx(t,{facedown:!S,value:e.value,suit:e.suit,small:!0,highlight:P(C(2))},`left-${a}`))})]}),e.players.length>3&&s.jsxs("div",{className:"player-seat right "+(3===k?"active":""),role:"region","aria-label":`Player ${C(3).name}${C(3).is_cpu?" (CPU)":""}${3===k?", current turn":""}`,children:[s.jsxs("h3",{children:[C(3).name,C(3).is_cpu&&" (CPU)"]}),s.jsx("div",{className:"hand horizontal","aria-label":`${C(3).name}'s hand with ${C(3).hand.length} cards`,children:C(3).hand.map((e,a)=>s.jsx(t,{facedown:!S,value:e.value,suit:e.suit,small:!0,highlight:P(C(3))},`right-${a}`))})]}),s.jsxs("div",{className:"table-center",children:[s.jsxs("div",{className:`deck-area ${p?"deck-highlight":""} ${f?"deck-shuffling":""}`,onClick:_?D:void 0,role:"button",tabIndex:_?0:-1,"aria-label":`Deck with ${e.deck?.length??0} cards remaining${_?", click to draw a card":""}`,onKeyDown:e=>{!_||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),D())},children:[s.jsx("div",{className:"deck-count","aria-hidden":"true",children:e.deck?.length??0}),(()=>{const a=e.players[e.current_player]?.name;return a===i&&!e.has_drawn&&!S})()&&s.jsx("div",{className:"tutorial-prompt",role:"status","aria-live":"polite",children:"Pick a card"}),s.jsx(t,{facedown:!0,value:"",suit:"",className:`${j||c.drawing?"card-drawing":""} ${f?"card-shuffling":""}`,style:{cursor:_?"pointer":"default"}})]}),s.jsx("div",{className:"discard-area",role:"region","aria-label":"Discard pile",children:e.pot?.length>0?s.jsx(t,{...e.pot[e.pot.length-1],className:"discard-top"}):s.jsx("div",{className:"discard-empty","aria-label":"Empty discard pile",children:"Empty"})})]}),s.jsxs("div",{className:"player-seat bottom "+(k===e.players.findIndex(e=>e?.name===i)?"active":""),role:"region","aria-label":"Your hand"+(k===e.players.findIndex(e=>e?.name===i)?", current turn":""),children:[s.jsx("h4",{className:"player-name",children:$.name}),s.jsx("div",{className:"hand","aria-label":`Your hand with ${$.hand?.length||0} cards`,children:$.hand?.map((a,i)=>{const r=y[i]||!1,p=r?`deal-delay-${Math.min(i+1,7)}`:"";return s.jsx(t,{...a,onClick:()=>(e=>{if(l===e){const a=document.querySelector(`[data-card-index="${e}"]`);if(a&&$){const s=a.getBoundingClientRect(),i=$.hand[e];o("discard"),navigator.vibrate&&navigator.vibrate([100,50,100]),m({card:i,position:{x:s.left,y:s.top}}),g(e);const t=window.innerWidth<=768?1800:1200;setTimeout(()=>{n(e),g(null),m(null)},t)}d(null)}else d(e),navigator.vibrate&&navigator.vibrate([30,20,30])})(i),disabled:!e.has_drawn||N.is_cpu||N.name!==$.name||c.discarding||null!==b||r,className:`${b===i?"card-discarding":""} ${r?`card-dealing ${p}`:""}`,highlight:P($),selected:l===i,style:{},"data-card-index":i},`you-${i}`)})})]}),u&&s.jsx(t,{...u.card,className:"discard-animation-overlay",style:{left:u.position.x,top:u.position.y,width:"70px",height:"100px"}})]})};export{n as GameTable,n as default};
