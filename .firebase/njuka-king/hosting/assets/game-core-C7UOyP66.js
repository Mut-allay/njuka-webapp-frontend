const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/game-components-BOPK325o.js","assets/react-vendor-C7tYskqo.js","assets/howler-vendor-FepDM4o1.js","assets/game-utils-B81P_-Bp.js","assets/game-components-ldK6loKu.css","assets/GameTable-BquGHEmw.js","assets/GameTable-CR5nN5I0.css"])))=>i.map(i=>d[i]);
import{r as e,g as n}from"./react-vendor-C7tYskqo.js";import{r as t}from"./howler-vendor-FepDM4o1.js";import{c as s,a}from"./game-utils-B81P_-Bp.js";var o,r,i={exports:{}},c={};var l=(r||(r=1,i.exports=function(){if(o)return c;o=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function t(n,t,s){var a=null;if(void 0!==s&&(a=""+s),void 0!==t.key&&(a=""+t.key),"key"in t)for(var o in s={},t)"key"!==o&&(s[o]=t[o]);else s=t;return t=s.ref,{$$typeof:e,type:n,key:a,ref:void 0!==t?t:null,props:s}}return c.Fragment=n,c.jsx=t,c.jsxs=t,c}()),i.exports),d=e();const u=n(d);var h=t();const m=({isOpen:e,onClose:n,title:t,showCloseButton:o=!0,closeButtonText:r="Close",closeOnOverlayClick:i=!0,closeOnEscape:c=!0,className:u="",contentClassName:h="",focusTrapOptions:m={},children:b,announceOnOpen:w=!0,announcementMessage:y})=>{const g=d.useRef(null),p=d.useRef(null);d.useEffect(()=>{if(e&&g.current&&(p.current=s(g.current,{restoreFocus:!0,...m}),p.current.activate(),w)){a(y||`${t} dialog opened`,"polite")}return()=>{p.current&&(p.current.deactivate(),p.current=null)}},[e,t,w,y,m]);const f=d.useCallback(t=>{e&&c&&"Escape"===t.key&&(t.preventDefault(),n())},[e,c,n]);d.useEffect(()=>{if(e)return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[e,f]);const C=d.useCallback(e=>{i&&e.target===e.currentTarget&&n()},[i,n]),j=d.useCallback(()=>{n()},[n]);return e?l.jsx("div",{className:`modal-overlay ${u}`,onClick:C,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",ref:g,children:l.jsxs("div",{className:`modal-content ${h}`,children:[l.jsxs("div",{className:"modal-header",children:[l.jsx("h2",{id:"modal-title",className:"modal-title",children:t}),o&&l.jsxs("button",{type:"button",className:"modal-close-button",onClick:j,"aria-label":`Close ${t} dialog`,children:[l.jsx("span",{"aria-hidden":"true",children:"Ã—"}),l.jsx("span",{className:"sr-only",children:r})]})]}),l.jsx("div",{className:"modal-body",children:b})]})}):null},b=({isOpen:e,onClose:n,title:t="Error",message:s,showRetryButton:a=!1,onRetry:o,retryButtonText:r="Retry"})=>l.jsxs(m,{isOpen:e,onClose:n,title:t,closeButtonText:"OK",className:"error-modal",contentClassName:"error-content",announceOnOpen:!0,announcementMessage:`${t}: ${s}`,children:[l.jsxs("div",{className:"error-message",children:[l.jsx("div",{className:"error-icon","aria-hidden":"true",children:"âš ï¸"}),l.jsx("p",{children:s})]}),l.jsxs("div",{className:"error-actions",children:[a&&o&&l.jsx("button",{className:"error-retry-button",onClick:()=>{o&&o(),n()},autoFocus:!0,children:r}),l.jsx("button",{className:"error-close-button",onClick:n,autoFocus:!a,children:"OK"})]})]}),w=({isVisible:e,message:n="Loading...",showSpinner:t=!0})=>(d.useEffect(()=>{if(e)return a(n,"polite"),document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}},[e,n]),e?l.jsx("div",{className:"loading-overlay",role:"status","aria-live":"polite","aria-label":n,children:l.jsxs("div",{className:"loading-content",children:[t&&l.jsxs("div",{className:"loading-spinner","aria-hidden":"true",children:[l.jsx("div",{className:"spinner-ring"}),l.jsx("div",{className:"spinner-ring"}),l.jsx("div",{className:"spinner-ring"})]}),l.jsx("p",{className:"loading-message",children:n})]})}):null);class y{ws=null;url;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;messageCallbacks=[];closeCallbacks=[];errorCallbacks=[];isConnecting=!1;shouldReconnect=!0;connectionTimeoutId=null;constructor(e,n,t="wss://njuka-webapp-backend.onrender.com"){const s=t.startsWith("ws")?t:`wss://${t}`;this.url=`${s}/ws/game/${e}?player_name=${encodeURIComponent(n)}`}async connect(){if(!this.isConnecting&&!this.isConnected()){this.isConnecting=!0;try{this.ws=new WebSocket(this.url);const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?1e4:5e3;this.connectionTimeoutId=setTimeout(()=>{this.ws&&this.ws.readyState===WebSocket.CONNECTING&&this.ws.close()},e),this.ws.onopen=()=>{this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.isConnecting=!1,this.reconnectAttempts=0,this.shouldReconnect=!0},this.ws.onmessage=e=>{try{const n=JSON.parse(e.data);this.messageCallbacks.forEach(e=>e(n))}catch(n){}},this.ws.onclose=e=>{this.isConnecting=!1,this.closeCallbacks.forEach(e=>e()),this.shouldReconnect&&this.reconnectAttempts<this.maxReconnectAttempts&&this.scheduleReconnect()},this.ws.onerror=e=>{this.isConnecting=!1,this.errorCallbacks.forEach(n=>n(e))}}catch(e){throw this.isConnecting=!1,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&setTimeout(()=>{this.shouldReconnect&&this.connect()},1e3),e}}}scheduleReconnect(){this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);setTimeout(()=>{this.shouldReconnect&&this.connect()},e)}disconnect(){this.shouldReconnect=!1,this.ws&&(this.ws.close(),this.ws=null)}send(e){this.isConnected()&&this.ws.send(JSON.stringify(e))}onMessage(e){this.messageCallbacks.push(e)}onClose(e){this.closeCallbacks.push(e)}onError(e){this.errorCallbacks.push(e)}isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}ping(){this.isConnected()&&this.send({type:"ping"})}}class g{ws=null;url;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;messageCallbacks=[];closeCallbacks=[];errorCallbacks=[];isConnecting=!1;shouldReconnect=!0;constructor(e,n="wss://njuka-webapp-backend.onrender.com"){const t=n.startsWith("ws")?n:`wss://${n}`;this.url=`${t}/ws/lobby/${e}`}async connect(){if(!this.isConnecting&&!this.isConnected()){this.isConnecting=!0;try{this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this.isConnecting=!1,this.reconnectAttempts=0,this.shouldReconnect=!0},this.ws.onmessage=e=>{try{const n=JSON.parse(e.data);this.messageCallbacks.forEach(e=>e(n))}catch(n){}},this.ws.onclose=e=>{this.isConnecting=!1,this.closeCallbacks.forEach(e=>e()),this.shouldReconnect&&this.reconnectAttempts<this.maxReconnectAttempts&&this.scheduleReconnect()},this.ws.onerror=e=>{this.isConnecting=!1,this.errorCallbacks.forEach(n=>n(e))}}catch(e){throw this.isConnecting=!1,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&setTimeout(()=>{this.shouldReconnect&&this.connect()},1e3),e}}}scheduleReconnect(){this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);setTimeout(()=>{this.shouldReconnect&&this.connect()},e)}disconnect(){this.shouldReconnect=!1,this.ws&&(this.ws.close(),this.ws=null)}send(e){this.isConnected()&&this.ws.send(JSON.stringify(e))}onMessage(e){this.messageCallbacks.push(e)}onClose(e){this.closeCallbacks.push(e)}onError(e){this.errorCallbacks.push(e)}isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}ping(){this.isConnected()&&this.send({type:"ping"})}}function p(e,n={}){const{autoConnect:t=!0,autoReconnect:s=!0,enablePollingFallback:a=!0,onConnect:o,onDisconnect:r,onError:i}=n,[c,l]=d.useState(!1),[u,h]=d.useState(!1),[m,b]=d.useState(!1),[w,y]=d.useState(null),[g,p]=d.useState(null),f=d.useRef(null),C=d.useRef(null),j=d.useRef(!0);d.useEffect(()=>()=>{j.current=!1,f.current&&clearInterval(f.current);const e=C.current;e&&clearTimeout(e)},[]);const v=d.useCallback(e=>{j.current&&y(e)},[]),x=d.useCallback(()=>{j.current&&(l(!0),h(!1),b(!1),p(null),o?.())},[o]),k=d.useCallback(()=>{j.current&&(l(!1),h(!1),r?.())},[r]),E=d.useCallback(e=>{j.current&&(p(e),h(!1),i?.(e))},[i]);d.useEffect(()=>{if(e)return e.onMessage(v),e.onClose(k),e.onError(E),()=>{}},[e,v,k,E]);const N=d.useCallback(()=>{m||b(!0)},[m]),S=d.useCallback(()=>{f.current&&(clearInterval(f.current),f.current=null),b(!1)},[]),T=d.useCallback(async()=>{if(e&&!u&&!c){h(!0),p(null);try{await e.connect(),x()}catch(n){E(n),a&&N()}}},[e,u,c,a,x,E,N]),P=d.useCallback(()=>{e&&e.disconnect(),S()},[e,S]),$=d.useCallback(n=>{e&&c&&e.send(n)},[e,c]);return d.useEffect(()=>{t&&e&&!c&&!u&&T()},[t,e,c,u,T]),d.useEffect(()=>{if(s&&!c&&!u&&!m&&e){const e=setTimeout(()=>{j.current&&T()},1e3);return()=>clearTimeout(e)}},[s,c,u,m,e,T]),{isConnected:c,isConnecting:u,isPolling:m,connect:T,disconnect:P,send:$,lastMessage:w,error:g}}const f=d.createContext(null);function C({children:e,baseUrl:n="ws://localhost:8000"}){const[t,s]=d.useState(null),[a,o]=d.useState(null);d.useEffect(()=>(s(null),o(null),()=>{}),[n]);const r=p(t,{autoConnect:!1,autoReconnect:!0,enablePollingFallback:!0}),i=p(a,{autoConnect:!1,autoReconnect:!0,enablePollingFallback:!0}),c=r.isConnected||i.isConnected,u=r.isConnecting||i.isConnecting,h={gameService:t,gameConnection:{...r,connect:async e=>{const t=new y(e,"Player",n);s(t),await t.connect()},disconnect:r.disconnect},lobbyService:a,lobbyConnection:{...i,connect:async e=>{const t=new g(e,n);o(t),await t.connect()},disconnect:i.disconnect},isAnyConnected:c,isAnyConnecting:u};return l.jsx(f.Provider,{value:h,children:e})}function j({showControls:e=!1,showDetails:n=!1,className:t=""}){const{gameConnection:s,lobbyConnection:a,isAnyConnected:o,isAnyConnecting:r}=function(){const e=d.useContext(f);if(!e)throw new Error("useWebSocketContext must be used within a WebSocketProvider");return e}();return l.jsxs("div",{className:`connection-status ${t}`,children:[l.jsxs("div",{className:"status-indicator "+(r?"connecting":o?"connected":"disconnected"),children:[l.jsx("div",{className:"status-dot"}),l.jsx("span",{className:"status-text",children:r?"Connecting...":o?"Connected":"Disconnected"})]}),n&&l.jsxs("div",{className:"connection-details",children:[l.jsxs("div",{className:"connection-item",children:[l.jsx("span",{className:"connection-label",children:"Game:"}),l.jsx("span",{className:"connection-value "+(s.isConnected?"connected":"disconnected"),children:s.isConnected?"Connected":"Disconnected"})]}),l.jsxs("div",{className:"connection-item",children:[l.jsx("span",{className:"connection-label",children:"Lobby:"}),l.jsx("span",{className:"connection-value "+(a.isConnected?"connected":"disconnected"),children:a.isConnected?"Connected":"Disconnected"})]})]}),e&&l.jsx("div",{className:"connection-controls",children:l.jsx("button",{onClick:()=>{s.isConnected&&s.disconnect(),a.isConnected&&a.disconnect()},disabled:r,className:"reconnect-button",children:"Reconnect"})})]})}const v={},x=function(e,n,t){let s=Promise.resolve();if(n&&n.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),a=t?.nonce||t?.getAttribute("nonce");s=e(n.map(e=>{if((e=function(e){return"/"+e}(e))in v)return;v[e]=!0;const n=e.endsWith(".css"),t=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${t}`))return;const s=document.createElement("link");return s.rel=n?"stylesheet":"modulepreload",n||(s.as="script"),s.crossOrigin="",s.href=e,a&&s.setAttribute("nonce",a),document.head.appendChild(s),n?new Promise((n,t)=>{s.addEventListener("load",n),s.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=e,window.dispatchEvent(n),!n.defaultPrevented)throw e}return s.then(n=>{for(const e of n||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};function k(e,n="Loading..."){const t=d.lazy(e);return function(e){return l.jsx(d.Suspense,{fallback:l.jsx(w,{isVisible:!0,message:n,showSpinner:!0}),children:l.jsx(t,{...e})})}}const E=k(()=>x(()=>import("./game-components-BOPK325o.js"),__vite__mapDeps([0,1,2,3,4])),"Loading game results..."),N=k(()=>x(()=>import("./GameTable-BquGHEmw.js"),__vite__mapDeps([5,1,2,3,6])),"Loading game table..."),S="https://njuka-webapp-backend.onrender.com",T=async(e,n,t=1,s=4)=>{try{const a=await fetch(`${S}/new_game?mode=${e}&player_name=${encodeURIComponent(n)}&cpu_count=${t}&max_players=${s}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.message||"Failed to create game")}return a.json()}catch(a){throw new Error("Network error. Please check your connection.")}},P=async(e,n)=>{try{const t=await fetch(`${S}/join_game?game_id=${e}&player_name=${encodeURIComponent(n)}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.message||"Failed to join game")}return t.json()}catch(t){throw new Error("Network error. Please check your connection.")}},$=async e=>{try{const n=await fetch(`${S}/game/${e}/draw`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.message||"Failed to draw card")}return n.json()}catch{throw new Error("Failed to connect to server. Please try again.")}},R=async(e,n)=>{try{const t=await fetch(`${S}/game/${e}/discard?card_index=${n}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.message||"Failed to discard card")}return t.json()}catch{throw new Error("Failed to connect to server. Please try again.")}},_=async()=>{try{return(await fetch(`${S}/health`)).ok}catch{return!1}},A=async()=>{try{const e=await fetch(`${S}/lobby/list`);if(!e.ok){if(404===e.status)return[];throw new Error("Failed to fetch lobbies")}return(await e.json()).lobbies||[]}catch(e){return[]}},O=async(e,n)=>{try{const t=await fetch(`${S}/lobby/create?host_name=${encodeURIComponent(e)}&max_players=${n}`,{method:"POST"});if(!t.ok)throw new Error("Failed to create lobby");return t.json()}catch(t){throw new Error("Failed to create lobby")}},I=async(e,n)=>{try{const t=await fetch(`${S}/lobby/join?lobby_id=${e}&player_name=${encodeURIComponent(n)}`,{method:"POST"});if(!t.ok){const e=(await t.json().catch(()=>({}))).detail||`HTTP ${t.status}: Failed to join lobby`;throw new Error(e)}return t.json()}catch(t){if(t instanceof Error)throw t;throw new Error("Failed to join lobby")}},F=async e=>{try{const n=await fetch(`${S}/lobby/${e}`);if(404===n.status)return null;if(!n.ok)throw new Error("Failed to fetch lobby details");return n.json()}catch(n){throw new Error("Failed to fetch lobby details")}},M=async(e,n)=>{try{const t=await fetch(`${S}/lobby/start?lobby_id=${e}&host_name=${encodeURIComponent(n)}`,{method:"POST"});if(!t.ok)throw new Error("Failed to start game");return t.json()}catch(t){throw new Error("Failed to start game")}};function L({lobby:e,playerName:n,onStartGame:t,onLeave:s,isHost:a}){return l.jsxs("div",{className:"new-game-form",children:[l.jsxs("h2",{children:["Lobby: ",e.id]}),l.jsxs("p",{children:["Host: ",e.host]}),l.jsxs("p",{children:["Players: ",e.players.length,"/",e.max_players]}),l.jsxs("div",{className:"player-list",children:[l.jsx("h3",{children:"Players:"}),l.jsx("ul",{children:e.players.map(t=>l.jsxs("li",{children:[t," ",t===n&&"(You)",t===e.host&&" ðŸ‘‘"]},t))})]}),a&&l.jsx("button",{onClick:t,disabled:e.players.length<2,className:e.players.length<2?"disabled-btn":"",children:e.players.length<2?"Waiting for more players...":"Start Game"}),l.jsx("button",{onClick:s,className:"quit-btn",children:"Leave Lobby"})]})}function G({quitGameToMenu:e,soundsEnabled:n,toggleSounds:t,playSound:s,onShowTutorial:a}){const o=e=>{s("button"),navigator.vibrate&&navigator.vibrate([40,20,40]),e()};return l.jsxs("footer",{className:"bottom-menu",children:[l.jsx("button",{onClick:()=>o(()=>{}),children:"Settings"}),l.jsxs("button",{onClick:()=>o(t),children:["ðŸ”Š ",n?"ON":"OFF"," "]}),l.jsx("button",{onClick:()=>o(a),children:"Info"}),l.jsx("button",{onClick:()=>o(e),children:"Quit"})]})}function B(){const[e,n]=d.useState(null),[t,s]=d.useState(null),[a,o]=d.useState({drawing:!1,discarding:!1,joining:!1,starting:!1,cpuMoving:!1}),[r,i]=d.useState(null),[c,u]=d.useState("main"),[m,y]=d.useState(1),[g,p]=d.useState(`Player${Math.floor(1e3*Math.random())}`),[f,v]=d.useState(!0),[x,k]=d.useState(null),[B,D]=d.useState([]),[U,q]=d.useState(!1),{playSound:W,soundsEnabled:H,toggleSounds:J,enableAudio:V}=(()=>{const[e,n]=d.useState(!0),t=d.useCallback((e,n,t="sine")=>{if("undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext))try{const s=new(window.AudioContext||window.webkitAudioContext);"suspended"===s.state&&s.resume();const a=s.createOscillator(),o=s.createGain();a.connect(o),o.connect(s.destination),a.frequency.setValueAtTime(e,s.currentTime),a.type=t,o.gain.setValueAtTime(.05,s.currentTime),o.gain.exponentialRampToValueAtTime(.001,s.currentTime+n),a.start(s.currentTime),a.stop(s.currentTime+n)}catch(r){}},[]),s=d.useMemo(()=>({draw:new h.Howl({src:["/sounds/draw.mp3","/sounds/draw.wav"],volume:.3,html5:!0,onloaderror:()=>{}}),discard:new h.Howl({src:["/sounds/discard.mp3","/sounds/discard.wav"],volume:.4,html5:!0,onloaderror:()=>{}}),win:new h.Howl({src:["/sounds/win.mp3","/sounds/win.wav"],volume:.5,html5:!0,onloaderror:()=>{}}),button:new h.Howl({src:["/sounds/button.mp3","/sounds/button.wav"],volume:.2,html5:!0,onloaderror:()=>{}}),shuffle:new h.Howl({src:["/sounds/shuffle.mp3","/sounds/shuffle.wav"],volume:.3,html5:!0,onloaderror:()=>{}})}),[]),a=d.useCallback(e=>{try{switch(e){case"draw":t(800,.2,"sine");break;case"discard":t(400,.3,"sawtooth");break;case"shuffle":setTimeout(()=>t(300,.1,"square"),0),setTimeout(()=>t(350,.1,"square"),100),setTimeout(()=>t(320,.1,"square"),200);break;case"win":t(523,.4,"sine"),setTimeout(()=>t(659,.4,"sine"),200),setTimeout(()=>t(784,.6,"sine"),400);break;case"button":t(1e3,.1,"square")}}catch(n){}},[t]),o=d.useCallback(n=>{if(e)try{const e=s[n];if("loaded"===e.state())try{e.play()}catch(t){a(n)}else a(n)}catch(r){a(n)}},[e,s,a]),i=d.useCallback(()=>{n(e=>!e)},[]),c=d.useCallback(()=>{if("undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext))try{const e=new(window.AudioContext||window.webkitAudioContext);"suspended"===e.state&&e.resume()}catch(r){}},[]);return{playSound:o,soundsEnabled:e,toggleSounds:i,enableAudio:c}})();d.useEffect(()=>{const e=window.location.pathname;u("/cpu"===e?"cpu":"/multiplayer"===e?"multiplayer":"main")},[]),d.useEffect(()=>{const e="main"===c?"/":`/${c}`;window.location.pathname!==e&&window.history.pushState({},"",e)},[c]),d.useEffect(()=>{const e=localStorage.getItem("njukaGame");if(e)try{const{id:n,playerName:t}=JSON.parse(e);n&&t&&(s(n),p(t))}catch{localStorage.removeItem("njukaGame")}},[]),d.useEffect(()=>{e?.id&&g?localStorage.setItem("njukaGame",JSON.stringify({id:e.id,playerName:g})):localStorage.removeItem("njukaGame")},[e,g]),d.useEffect(()=>{e?.game_over&&e?.winner&&(W("win"),navigator.vibrate&&navigator.vibrate([200,100,200,100,200]))},[e?.game_over,e?.winner,W]),d.useEffect(()=>{if(!e||e.game_over)return;e.players[e.current_player].name===g||W("draw")},[e?.current_player,e?.has_drawn,g,W,e]),d.useEffect(()=>{if(!e||e.game_over)return;if(!(e.players[e.current_player].name===g)&&e.has_drawn){const e=setTimeout(()=>{W("discard")},1e3);return()=>clearTimeout(e)}},[e?.has_drawn,e?.current_player,g,W,e]),d.useEffect(()=>{if(!e)return;const n=e.players.find(e=>e?.name===g);!localStorage.getItem("njuka-tutorial-seen")&&n?.hand&&n.hand.length>0&&setTimeout(()=>{q(!0),localStorage.setItem("njuka-tutorial-seen","true")},1e3)},[e,g]);const K=d.useCallback(async()=>{o(e=>({...e,starting:!0,joining:!0}));try{const e=await _();v(e),e||i("Backend service unavailable. Please try again later.")}catch{v(!1),i("Cannot connect to game server. Please try again later.")}finally{o(e=>({...e,starting:!1,joining:!1}))}},[]);d.useEffect(()=>{K()},[K]),d.useEffect(()=>{const e=()=>{V(),document.removeEventListener("touchstart",e),document.removeEventListener("click",e)};return document.addEventListener("touchstart",e,{once:!0}),document.addEventListener("click",e,{once:!0}),()=>{document.removeEventListener("touchstart",e),document.removeEventListener("click",e)}},[V]),d.useEffect(()=>{if(!t||!f)return;let e,a=3,o=2e3;const r=async()=>{try{const r=await fetch(`${S}/game/${t}`);if(!r.ok){if(404===r.status)return i("Game not found or expired. Returning to main menu."),n(null),s(null),void clearInterval(e);throw new Error("Network response was not ok")}const c=await r.json();n(c),a=3,o=2e3}catch(c){a--,o=Math.min(1.5*o,1e4),a<=0?(i("Connection lost. Trying to reconnect..."),clearInterval(e),setTimeout(async()=>{await K(),f&&(o=2e3,e=setInterval(r,o),r()),a=3},5e3)):(clearInterval(e),e=setInterval(r,o))}};return e=setInterval(r,o),r(),()=>clearInterval(e)},[t,f,K]),d.useEffect(()=>{if(!e||e.game_over||!f)return;const t=e.players[e.current_player],s=t.name===g;if(t?.is_cpu&&!s&&!a.cpuMoving){o(e=>({...e,cpuMoving:!0}));(async()=>{try{await new Promise(e=>setTimeout(e,1e3)),W("draw");const s=await $(e.id);n(s),await new Promise(e=>setTimeout(e,1e3));const a=s.players.find(e=>e.name===t.name);if(a&&a.hand.length>0){const e=Math.floor(Math.random()*a.hand.length);W("discard");const t=await R(s.id,e);n(t)}else{const t=await fetch(`${S}/game/${e.id}`).then(e=>e.json());n(t)}}catch(s){try{const t=await fetch(`${S}/game/${e.id}`).then(e=>e.json());n(t)}catch(a){}}finally{o(e=>({...e,cpuMoving:!1}))}})()}},[e,g,f,a.cpuMoving,W]),d.useEffect(()=>{if("multiplayer"!==c||!f)return;const e=setInterval(()=>{A().then(D).catch(()=>{})},5e3);return()=>clearInterval(e)},[c,f]),d.useEffect(()=>{if(!x||!f)return;const e=setInterval(async()=>{try{const t=await F(x.id);if(null===t)k(null),i("Lobby disappeared. It might have started or expired. Please check available games."),u("main");else if(t.started&&t.game_id)try{const e=await P(t.game_id,g);k(null),s(e.id),n(e)}catch(e){const n=e instanceof Error?e.message:"Failed to join game after lobby started.";i(n),k(null),u("main")}else k(t)}catch(t){const e=t instanceof Error?t.message:"An unexpected error occurred while fetching lobby details.";i(e)}},3e3);return()=>clearInterval(e)},[x,f,g]);if(!f)return l.jsxs("div",{className:"App",children:[l.jsx("h1",{children:"Njuka King"}),l.jsxs("div",{className:"error-notice",children:[l.jsx("h3",{children:"Service Unavailable"}),l.jsx("p",{children:"We're having trouble connecting to the game server."}),l.jsx("button",{onClick:()=>window.location.reload(),className:"retry-btn",children:"Retry Connection"})]})]});const Y=()=>{n(null),s(null),u("main")};return l.jsx(C,{baseUrl:"wss://njuka-webapp-backend.onrender.com",children:l.jsxs("div",{className:"App",children:[l.jsx("h1",{children:"Njuka King"}),l.jsx(j,{showControls:!0,showDetails:!0,className:"connection-status-top"}),l.jsx(b,{isOpen:!!r,onClose:()=>i(null),message:r||"",showRetryButton:r?.includes("Connection")||r?.includes("Network")||!1,onRetry:()=>window.location.reload(),retryButtonText:"Retry Connection"}),l.jsx(w,{isVisible:a.starting||a.joining,message:"Connecting to game server..."}),e?l.jsxs("div",{className:"game-container",children:[l.jsx("div",{}),l.jsx(N,{state:e,playerName:g,onDiscard:async t=>{o(e=>({...e,discarding:!0})),i(null);try{if(!e)return;const s=await R(e.id,t);n(s)}catch(s){const e=s instanceof Error?s.message:"Failed to discard card";i(e)}finally{o(e=>({...e,discarding:!1}))}},onDraw:async()=>{o(e=>({...e,drawing:!0})),i(null);try{if(!e)return;const t=await $(e.id);n(t)}catch(t){const e=t instanceof Error?t.message:"Failed to draw card";i(e)}finally{o(e=>({...e,drawing:!1}))}},loadingStates:a,playSound:W,showTutorial:U,onCloseTutorial:()=>{q(!1)}}),l.jsx(G,{quitGameToMenu:Y,soundsEnabled:H,toggleSounds:J,playSound:W,onShowTutorial:()=>{q(!0)}}),l.jsx(E,{isOpen:!!e.game_over,onClose:Y,winner:e.winner||"Unknown",winnerHand:e.winner_hand,onNewGame:Y})]}):x?l.jsx(L,{lobby:x,playerName:g,onStartGame:async()=>{if(x){W("button"),o(e=>({...e,starting:!0})),i(null);try{const e=await M(x.id,g);k(null),s(e.id),n(e),W("shuffle")}catch(e){const n=e instanceof Error?e.message:"Failed to start game. Please try again.";i(n)}finally{o(e=>({...e,starting:!1}))}}},onLeave:()=>{k(null),u("main")},isHost:x.host===g}):l.jsxs("div",{className:"new-game-form",children:["main"===c&&l.jsxs(l.Fragment,{children:[l.jsx("h2",{children:"Start or Join a Game"}),l.jsxs("label",{children:["Your Name:",l.jsx("input",{type:"text",value:g,onChange:e=>{const n=e.target.value.trim();n.length<=20&&p(n)},placeholder:"Enter your name (2-20 chars)",minLength:2,maxLength:20,required:!0})]}),l.jsx("button",{onClick:()=>u("multiplayer"),disabled:!g.trim(),className:g.trim()?"":"disabled-btn",children:"Multiplayer"}),l.jsx("button",{onClick:()=>u("cpu"),disabled:!g.trim(),className:g.trim()?"":"disabled-btn",children:"Play vs CPU"})]}),"multiplayer"===c&&l.jsxs(l.Fragment,{children:[l.jsx("h2",{children:"Multiplayer Lobby"}),l.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px"},children:[l.jsx("button",{onClick:()=>u("main"),children:"Back to Main Menu"}),l.jsx("button",{onClick:()=>{A().then(D).catch(e=>{const n=e instanceof Error?e.message:"Failed to refresh lobbies";i(n)})},children:"Refresh Lobbies"})]}),l.jsxs("label",{children:["Max Players for New Lobby:",l.jsx("input",{type:"number",min:2,max:6,value:m,onChange:e=>y(Number(e.target.value))})]}),l.jsx("button",{onClick:async()=>{W("button"),o(e=>({...e,starting:!0})),i(null);try{const e=await O(g,m);k(e),W("shuffle")}catch(e){const n=e instanceof Error?e.message:"Failed to create lobby";i(n)}finally{o(e=>({...e,starting:!1}))}},disabled:a.starting||!g.trim()||m<2,className:a.starting||!g.trim()||m<2?"disabled-btn":"",children:a.starting?"Creating Lobby...":"Create New Game"}),l.jsx("div",{className:"divider",children:"OR"}),l.jsx("h3",{children:"Available Lobbies"}),l.jsx("div",{className:"lobby-list",children:0===B.length?l.jsx("p",{children:"No available games found. Create a new game to start playing!"}):B.map(e=>l.jsxs("div",{className:"lobby-item",children:[l.jsxs("h3",{children:["Host: ",e.host]}),l.jsxs("p",{children:["Players: ",e.players.join(", ")]}),l.jsxs("p",{children:["Slots: ",e.players.length,"/",e.max_players]}),l.jsxs("p",{children:["Created: ",new Date(e.created_at).toLocaleString()]}),l.jsx("button",{onClick:()=>(async e=>{W("button"),o(e=>({...e,joining:!0})),i(null);try{const n=await I(e,g);k(n),W("draw")}catch(n){let e="Failed to join lobby. Please try again.";n instanceof Error&&(e=n.message.includes("Name already taken")?"This name is already taken in this lobby. Please choose a different name.":n.message.includes("Lobby not found")?"This lobby no longer exists. Please refresh the lobby list.":n.message.includes("Lobby is full")?"This lobby is full. Please join a different lobby.":n.message),i(e)}finally{o(e=>({...e,joining:!1}))}})(e.id),disabled:e.players.length>=e.max_players||a.joining,children:a.joining?"Joining...":"Join Game"})]},e.id))})]}),"cpu"===c&&l.jsxs(l.Fragment,{children:[l.jsx("h2",{children:"Play vs CPU"}),l.jsxs("label",{children:["Number of CPU Players:",l.jsx("input",{type:"number",min:1,max:3,value:m,onChange:e=>y(Number(e.target.value))})]}),l.jsx("button",{onClick:async()=>{W("button"),o(e=>({...e,starting:!0})),i(null);try{const e=await T("cpu",g,m);s(e.id),n(e),W("shuffle")}catch(e){const n=e instanceof Error?e.message:"Failed to create game";i(n)}finally{o(e=>({...e,starting:!1}))}},disabled:a.starting||!g.trim(),className:a.starting||!g.trim()?"disabled-btn":"",children:a.starting?"Starting Game...":"Start Game"}),l.jsx("button",{onClick:()=>u("main"),className:"quit-btn",children:"Back to Main Menu"})]})]})]})})}export{B as A,m as M,u as R,l as j,d as r};
