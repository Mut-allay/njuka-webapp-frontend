const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GameTable-BJRuAdRW.js","assets/react-vendor-C7tYskqo.js","assets/howler-vendor-FepDM4o1.js","assets/game-utils-IwOw0342.js","assets/GameTable-JJXt5KYL.css","assets/game-components-D0SIJX6_.js","assets/game-components-ldK6loKu.css"])))=>i.map(i=>d[i]);
import{r as e,g as n}from"./react-vendor-C7tYskqo.js";import{r as s}from"./howler-vendor-FepDM4o1.js";import{a as t,c as a}from"./game-utils-IwOw0342.js";var o,i,c={exports:{}},r={};var l=(i||(i=1,c.exports=function(){if(o)return r;o=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function s(n,s,t){var a=null;if(void 0!==t&&(a=""+t),void 0!==s.key&&(a=""+s.key),"key"in s)for(var o in t={},s)"key"!==o&&(t[o]=s[o]);else t=s;return s=t.ref,{$$typeof:e,type:n,key:a,ref:void 0!==s?s:null,props:t}}return r.Fragment=n,r.jsx=s,r.jsxs=s,r}()),c.exports),d=e();const h=n(d);var u=s();
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m=e=>{const n=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,s)=>s?s.toUpperCase():n.toLowerCase()))(e);return n.charAt(0).toUpperCase()+n.slice(1)},p=(...e)=>e.filter((e,n,s)=>Boolean(e)&&""!==e.trim()&&s.indexOf(e)===n).join(" ").trim(),y=e=>{for(const n in e)if(n.startsWith("aria-")||"role"===n||"title"===n)return!0};
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var w={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=d.forwardRef(({color:e="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:t,className:a="",children:o,iconNode:i,...c},r)=>d.createElement("svg",{ref:r,...w,width:n,height:n,stroke:e,strokeWidth:t?24*Number(s)/Number(n):s,className:p("lucide",a),...!o&&!y(c)&&{"aria-hidden":"true"},...c},[...i.map(([e,n])=>d.createElement(e,n)),...Array.isArray(o)?o:[o]])),j=(e,n)=>{const s=d.forwardRef(({className:s,...t},a)=>{return d.createElement(b,{ref:a,iconNode:n,className:p(`lucide-${o=m(e),o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,s),...t});var o});return s.displayName=m(e),s},x=j("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),g=j("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]),f=j("bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),v=j("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),k=j("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),C=j("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),N=j("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),S=j("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),E=j("volume-x",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),P={},T=function(e,n,s){let t=Promise.resolve();if(n&&n.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");t=e(n.map(e=>{if((e=function(e){return"/"+e}(e))in P)return;P[e]=!0;const n=e.endsWith(".css"),s=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const t=document.createElement("link");return t.rel=n?"stylesheet":"modulepreload",n||(t.as="script"),t.crossOrigin="",t.href=e,a&&t.setAttribute("nonce",a),document.head.appendChild(t),n?new Promise((n,s)=>{t.addEventListener("load",n),t.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=e,window.dispatchEvent(n),!n.defaultPrevented)throw e}return t.then(n=>{for(const e of n||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})},A=({isVisible:e,message:n="Loading...",showSpinner:s=!0})=>(d.useEffect(()=>{if(e)return t(n,"polite"),document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}},[e,n]),e?l.jsx("div",{className:"loading-overlay",role:"status","aria-live":"polite","aria-label":n,children:l.jsxs("div",{className:"loading-content",children:[s&&l.jsxs("div",{className:"loading-spinner","aria-hidden":"true",children:[l.jsx("div",{className:"spinner-ring"}),l.jsx("div",{className:"spinner-ring"}),l.jsx("div",{className:"spinner-ring"})]}),l.jsx("p",{className:"loading-message",children:n})]})}):null);
/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function R(e,n="Loading..."){const s=d.lazy(e);return function(e){return l.jsx(d.Suspense,{fallback:l.jsx(A,{isVisible:!0,message:n,showSpinner:!0}),children:l.jsx(s,{...e})})}}const $=R(()=>T(()=>import("./GameTable-BJRuAdRW.js"),__vite__mapDeps([0,1,2,3,4])),"Loading game table..."),M=R(()=>T(()=>import("./game-components-D0SIJX6_.js").then(e=>e.G),__vite__mapDeps([5,6])),"Loading game results..."),O=R(()=>T(()=>import("./game-components-D0SIJX6_.js").then(e=>e.T),__vite__mapDeps([5,6])),"Loading tutorial..."),L=({isOpen:e,onClose:n,title:s,showCloseButton:o=!0,closeButtonText:i="Close",closeOnOverlayClick:c=!0,closeOnEscape:r=!0,className:h="",contentClassName:u="",focusTrapOptions:m={},children:p,announceOnOpen:y=!0,announcementMessage:w})=>{const b=d.useRef(null),j=d.useRef(null);d.useEffect(()=>{if(e&&b.current&&(j.current=a(b.current,{restoreFocus:!0,...m}),j.current.activate(),y)){t(w||`${s} dialog opened`,"polite")}return()=>{j.current&&(j.current.deactivate(),j.current=null)}},[e,s,y,w,m]);const x=d.useCallback(s=>{e&&r&&"Escape"===s.key&&(s.preventDefault(),n())},[e,r,n]);d.useEffect(()=>{if(e)return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[e,x]);const g=d.useCallback(e=>{c&&e.target===e.currentTarget&&n()},[c,n]),f=d.useCallback(()=>{n()},[n]);return e?l.jsx("div",{className:`modal-overlay ${h}`,onClick:g,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",ref:b,children:l.jsxs("div",{className:`modal-content ${u}`,children:[l.jsxs("div",{className:"modal-header",children:[l.jsx("h2",{id:"modal-title",className:"modal-title",children:s}),o&&l.jsxs("button",{type:"button",className:"modal-close-button",onClick:f,"aria-label":`Close ${s} dialog`,children:[l.jsx("span",{"aria-hidden":"true",children:"Ã—"}),l.jsx("span",{className:"sr-only",children:i})]})]}),l.jsx("div",{className:"modal-body",children:p})]})}):null},_=({isOpen:e,onClose:n,title:s="Error",message:t,showRetryButton:a=!1,onRetry:o,retryButtonText:i="Retry"})=>l.jsxs(L,{isOpen:e,onClose:n,title:s,closeButtonText:"OK",className:"error-modal",contentClassName:"error-content",announceOnOpen:!0,announcementMessage:`${s}: ${t}`,children:[l.jsxs("div",{className:"error-message",children:[l.jsx("div",{className:"error-icon","aria-hidden":"true",children:"âš ï¸"}),l.jsx("p",{children:t})]}),l.jsxs("div",{className:"error-actions",children:[a&&o&&l.jsx("button",{className:"error-retry-button",onClick:()=>{o&&o(),n()},autoFocus:!0,children:i}),l.jsx("button",{className:"error-close-button",onClick:n,autoFocus:!a,children:"OK"})]})]});class I{ws=null;url;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;messageCallbacks=[];closeCallbacks=[];errorCallbacks=[];isConnecting=!1;shouldReconnect=!0;connectionTimeoutId=null;constructor(e,n,s="wss://njuka-webapp-backend.onrender.com"){const t=s.startsWith("ws")?s:`wss://${s}`;this.url=`${t}/ws/game/${e}?player_name=${encodeURIComponent(n)}`}async connect(){if(!this.isConnecting&&!this.isConnected()){this.isConnecting=!0;try{this.ws=new WebSocket(this.url);const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?1e4:5e3;this.connectionTimeoutId=setTimeout(()=>{this.ws&&this.ws.readyState===WebSocket.CONNECTING&&this.ws.close()},e),this.ws.onopen=()=>{this.connectionTimeoutId&&(clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=null),this.isConnecting=!1,this.reconnectAttempts=0,this.shouldReconnect=!0},this.ws.onmessage=e=>{try{const n=JSON.parse(e.data);this.messageCallbacks.forEach(e=>e(n))}catch(n){}},this.ws.onclose=e=>{this.isConnecting=!1,this.closeCallbacks.forEach(e=>e()),this.shouldReconnect&&this.reconnectAttempts<this.maxReconnectAttempts&&this.scheduleReconnect()},this.ws.onerror=e=>{this.isConnecting=!1,this.errorCallbacks.forEach(n=>n(e))}}catch(e){throw this.isConnecting=!1,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&setTimeout(()=>{this.shouldReconnect&&this.connect()},1e3),e}}}scheduleReconnect(){this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);setTimeout(()=>{this.shouldReconnect&&this.connect()},e)}disconnect(){this.shouldReconnect=!1,this.ws&&(this.ws.close(),this.ws=null)}send(e){this.isConnected()&&this.ws.send(JSON.stringify(e))}onMessage(e){this.messageCallbacks.push(e)}onClose(e){this.closeCallbacks.push(e)}onError(e){this.errorCallbacks.push(e)}isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}ping(){this.isConnected()&&this.send({type:"ping"})}}class F{ws=null;url;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;messageCallbacks=[];closeCallbacks=[];errorCallbacks=[];isConnecting=!1;shouldReconnect=!0;constructor(e,n="wss://njuka-webapp-backend.onrender.com"){const s=n.startsWith("ws")?n:`wss://${n}`;this.url=`${s}/ws/lobby/${e}`}async connect(){if(!this.isConnecting&&!this.isConnected()){this.isConnecting=!0;try{this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this.isConnecting=!1,this.reconnectAttempts=0,this.shouldReconnect=!0},this.ws.onmessage=e=>{try{const n=JSON.parse(e.data);this.messageCallbacks.forEach(e=>e(n))}catch(n){}},this.ws.onclose=e=>{this.isConnecting=!1,this.closeCallbacks.forEach(e=>e()),this.shouldReconnect&&this.reconnectAttempts<this.maxReconnectAttempts&&this.scheduleReconnect()},this.ws.onerror=e=>{this.isConnecting=!1,this.errorCallbacks.forEach(n=>n(e))}}catch(e){throw this.isConnecting=!1,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&setTimeout(()=>{this.shouldReconnect&&this.connect()},1e3),e}}}scheduleReconnect(){this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);setTimeout(()=>{this.shouldReconnect&&this.connect()},e)}disconnect(){this.shouldReconnect=!1,this.ws&&(this.ws.close(),this.ws=null)}send(e){this.isConnected()&&this.ws.send(JSON.stringify(e))}onMessage(e){this.messageCallbacks.push(e)}onClose(e){this.closeCallbacks.push(e)}onError(e){this.errorCallbacks.push(e)}isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}ping(){this.isConnected()&&this.send({type:"ping"})}}function B(e,n={}){const{autoConnect:s=!0,autoReconnect:t=!0,enablePollingFallback:a=!0,onConnect:o,onDisconnect:i,onError:c}=n,[r,l]=d.useState(!1),[h,u]=d.useState(!1),[m,p]=d.useState(!1),[y,w]=d.useState(null),[b,j]=d.useState(null),x=d.useRef(null),g=d.useRef(null),f=d.useRef(!0);d.useEffect(()=>()=>{f.current=!1,x.current&&clearInterval(x.current);const e=g.current;e&&clearTimeout(e)},[]);const v=d.useCallback(e=>{f.current&&w(e)},[]),k=d.useCallback(()=>{f.current&&(l(!0),u(!1),p(!1),j(null),o?.())},[o]),C=d.useCallback(()=>{f.current&&(l(!1),u(!1),i?.())},[i]),N=d.useCallback(e=>{f.current&&(j(e),u(!1),c?.(e))},[c]);d.useEffect(()=>{if(e)return e.onMessage(v),e.onClose(C),e.onError(N),()=>{}},[e,v,C,N]);const S=d.useCallback(()=>{m||p(!0)},[m]),E=d.useCallback(()=>{x.current&&(clearInterval(x.current),x.current=null),p(!1)},[]),P=d.useCallback(async()=>{if(e&&!h&&!r){u(!0),j(null);try{await e.connect(),k()}catch(n){N(n),a&&S()}}},[e,h,r,a,k,N,S]),T=d.useCallback(()=>{e&&e.disconnect(),E()},[e,E]),A=d.useCallback(n=>{e&&r&&e.send(n)},[e,r]);return d.useEffect(()=>{s&&e&&!r&&!h&&P()},[s,e,r,h,P]),d.useEffect(()=>{if(t&&!r&&!h&&!m&&e){const e=setTimeout(()=>{f.current&&P()},1e3);return()=>clearTimeout(e)}},[t,r,h,m,e,P]),{isConnected:r,isConnecting:h,isPolling:m,connect:P,disconnect:T,send:A,lastMessage:y,error:b}}const D=d.createContext(null);function U({children:e,baseUrl:n="ws://localhost:8000"}){const[s,t]=d.useState(null),[a,o]=d.useState(null);d.useEffect(()=>(t(null),o(null),()=>{}),[n]);const i=B(s,{autoConnect:!1,autoReconnect:!0,enablePollingFallback:!0}),c=B(a,{autoConnect:!1,autoReconnect:!0,enablePollingFallback:!0}),r=i.isConnected||c.isConnected,h=i.isConnecting||c.isConnecting,u={gameService:s,gameConnection:{...i,connect:async e=>{const s=new I(e,"Player",n);t(s),await s.connect()},disconnect:i.disconnect},lobbyService:a,lobbyConnection:{...c,connect:async e=>{const s=new F(e,n);o(s),await s.connect()},disconnect:c.disconnect},isAnyConnected:r,isAnyConnecting:h};return l.jsx(D.Provider,{value:u,children:e})}function z({showControls:e=!1,showDetails:n=!1,className:s=""}){const{gameConnection:t,lobbyConnection:a,isAnyConnected:o,isAnyConnecting:i}=function(){const e=d.useContext(D);if(!e)throw new Error("useWebSocketContext must be used within a WebSocketProvider");return e}();return l.jsxs("div",{className:`connection-status ${s}`,children:[l.jsxs("div",{className:"status-indicator "+(i?"connecting":o?"connected":"disconnected"),children:[l.jsx("div",{className:"status-dot"}),l.jsx("span",{className:"status-text",children:i?"Connecting...":o?"Connected":"Disconnected"})]}),n&&l.jsxs("div",{className:"connection-details",children:[l.jsxs("div",{className:"connection-item",children:[l.jsx("span",{className:"connection-label",children:"Game:"}),l.jsx("span",{className:"connection-value "+(t.isConnected?"connected":"disconnected"),children:t.isConnected?"Connected":"Disconnected"})]}),l.jsxs("div",{className:"connection-item",children:[l.jsx("span",{className:"connection-label",children:"Lobby:"}),l.jsx("span",{className:"connection-value "+(a.isConnected?"connected":"disconnected"),children:a.isConnected?"Connected":"Disconnected"})]})]}),e&&l.jsx("div",{className:"connection-controls",children:l.jsx("button",{onClick:()=>{t.isConnected&&t.disconnect(),a.isConnected&&a.disconnect()},disabled:i,className:"reconnect-button",children:"Reconnect"})})]})}const H="https://njuka-webapp-backend.onrender.com",q=async(e,n,s=1,t=4)=>{try{const a=await fetch(`${H}/new_game?mode=${e}&player_name=${encodeURIComponent(n)}&cpu_count=${s}&max_players=${t}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.message||"Failed to create game")}return a.json()}catch(a){throw new Error("Network error. Please check your connection.")}},W=async(e,n)=>{try{const s=await fetch(`${H}/join_game?game_id=${e}&player_name=${encodeURIComponent(n)}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.message||"Failed to join game")}return s.json()}catch(s){throw new Error("Network error. Please check your connection.")}},G=async e=>{try{const n=await fetch(`${H}/game/${e}/draw`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.message||"Failed to draw card")}return n.json()}catch{throw new Error("Failed to connect to server. Please try again.")}},V=async(e,n)=>{try{const s=await fetch(`${H}/game/${e}/discard?card_index=${n}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.message||"Failed to discard card")}return s.json()}catch{throw new Error("Failed to connect to server. Please try again.")}},J=async()=>{try{return(await fetch(`${H}/health`)).ok}catch{return!1}},K=async()=>{try{const e=await fetch(`${H}/lobby/list`);if(!e.ok){if(404===e.status)return[];throw new Error("Failed to fetch lobbies")}return(await e.json()).lobbies||[]}catch(e){return[]}},Y=async(e,n)=>{try{const s=await fetch(`${H}/lobby/create?host_name=${encodeURIComponent(e)}&max_players=${n}`,{method:"POST"});if(!s.ok)throw new Error("Failed to create lobby");return s.json()}catch(s){throw new Error("Failed to create lobby")}},Z=async(e,n)=>{try{const s=await fetch(`${H}/lobby/join?lobby_id=${e}&player_name=${encodeURIComponent(n)}`,{method:"POST"});if(!s.ok)throw new Error("Failed to join lobby");return s.json()}catch(s){throw new Error("Failed to join lobby")}},Q=async e=>{try{const n=await fetch(`${H}/lobby/${e}`);if(404===n.status)return null;if(!n.ok)throw new Error("Failed to fetch lobby details");return n.json()}catch(n){throw new Error("Failed to fetch lobby details")}},X=({onSelectMode:e,playerName:n,setPlayerName:s})=>l.jsxs("div",{className:"page-container",children:[l.jsxs("div",{className:"welcome-section",children:[l.jsx("h2",{children:"Welcome to Njuka King!"}),l.jsx("p",{children:"Choose your game mode to start playing"})]}),l.jsxs("div",{className:"new-game-form",children:[l.jsxs("label",{children:["Your Name:",l.jsx("input",{type:"text",value:n,onChange:e=>{const n=e.target.value.trim();n.length<=20&&s(n)},placeholder:"Enter your name (2-20 chars)",minLength:2,maxLength:20,required:!0})]}),l.jsxs("div",{className:"game-mode-buttons",children:[l.jsxs("button",{className:"mode-button multiplayer-button",onClick:()=>e("multiplayer"),disabled:!n.trim(),children:[l.jsx(N,{size:32}),l.jsx("span",{children:"Multiplayer"}),l.jsx("p",{children:"Play with friends online"})]}),l.jsxs("button",{className:"mode-button cpu-button",onClick:()=>e("cpu"),disabled:!n.trim(),children:[l.jsx(f,{size:32}),l.jsx("span",{children:"VS CPU"}),l.jsx("p",{children:"Play against computer opponents"})]})]})]})]}),ee=({onBack:e,playerName:n,numPlayers:s,setNumPlayers:t,onCreateLobby:a,onJoinLobby:o,lobbies:i,loadingStates:c,onRefreshLobbies:r})=>l.jsxs("div",{className:"page-container",children:[l.jsxs("div",{className:"page-header",children:[l.jsxs("button",{onClick:e,className:"back-button",children:[l.jsx(x,{size:20}),"Back"]}),l.jsx("h2",{children:"Multiplayer Lobby"})]}),l.jsxs("div",{className:"multiplayer-content",children:[l.jsxs("div",{className:"create-lobby-section",children:[l.jsx("h3",{children:"Create New Game"}),l.jsxs("label",{children:["Max Players:",l.jsxs("select",{value:s,onChange:e=>t(Number(e.target.value)),children:[l.jsx("option",{value:2,children:"2 Players"}),l.jsx("option",{value:3,children:"3 Players"}),l.jsx("option",{value:4,children:"4 Players"}),l.jsx("option",{value:5,children:"5 Players"}),l.jsx("option",{value:6,children:"6 Players"})]})]}),l.jsx("button",{onClick:a,disabled:c.starting||!n.trim(),className:"create-lobby-btn",children:c.starting?"Creating...":"Create New Game"})]}),l.jsx("div",{className:"divider",children:l.jsx("span",{children:"OR"})}),l.jsxs("div",{className:"join-lobby-section",children:[l.jsxs("div",{className:"lobby-header",children:[l.jsx("h3",{children:"Available Lobbies"}),l.jsx("button",{onClick:r,className:"refresh-btn",children:"Refresh"})]}),l.jsx("div",{className:"lobby-list",children:0===i.length?l.jsxs("div",{className:"no-lobbies",children:[l.jsx("p",{children:"No games available right now."}),l.jsx("p",{children:"Create a new game to start playing!"})]}):i.map(e=>l.jsxs("div",{className:"lobby-item",children:[l.jsxs("div",{className:"lobby-info",children:[l.jsxs("h4",{children:["Host: ",e.host]}),l.jsxs("p",{children:["Players: ",e.players.length,"/",e.max_players]}),l.jsx("div",{className:"player-list-preview",children:e.players.map(n=>l.jsxs("span",{className:"player-tag",children:[n,n===e.host&&" ðŸ‘‘"]},n))}),l.jsxs("p",{className:"lobby-created",children:["Created: ",new Date(e.created_at).toLocaleString()]})]}),l.jsx("button",{onClick:()=>o(e.id),disabled:e.players.length>=e.max_players||c.joining,className:"join-lobby-btn",children:c.joining?"Joining...":"Join Game"})]},e.id))})]})]})]}),ne=({onBack:e,onStartGame:n,numCPU:s,setNumCPU:t,loadingStates:a})=>l.jsxs("div",{className:"page-container",children:[l.jsxs("div",{className:"page-header",children:[l.jsxs("button",{onClick:e,className:"back-button",children:[l.jsx(x,{size:20}),"Back"]}),l.jsx("h2",{children:"Play vs CPU"})]}),l.jsx("div",{className:"cpu-game-content",children:l.jsxs("div",{className:"cpu-options",children:[l.jsx("h3",{children:"Choose Your Opponents"}),l.jsx("p",{children:"Select how many CPU players you want to face"}),l.jsxs("div",{className:"cpu-selection",children:[l.jsx("label",{children:"Number of CPU Players:"}),l.jsx("div",{className:"cpu-buttons",children:[1,2,3].map(e=>l.jsxs("button",{onClick:()=>t(e),className:"cpu-count-btn "+(s===e?"selected":""),children:[e," CPU"]},e))})]}),l.jsxs("div",{className:"difficulty-info",children:[l.jsx("h4",{children:"CPU Difficulty: Smart"}),l.jsx("p",{children:"CPU players will make strategic decisions and try to win!"})]}),l.jsx("button",{onClick:n,disabled:a.starting,className:"start-cpu-game-btn",children:a.starting?"Starting Game...":`Start Game vs ${s} CPU`})]})})]}),se=({onBack:e})=>l.jsxs("div",{className:"page-container",children:[l.jsxs("div",{className:"page-header",children:[l.jsxs("button",{onClick:e,className:"back-button",children:[l.jsx(x,{size:20}),"Back"]}),l.jsx("h2",{children:"How to Play Njuka King"})]}),l.jsxs("div",{className:"rules-content",children:[l.jsxs("section",{className:"rules-section",children:[l.jsx("h3",{children:"ðŸŽ¯ Objective"}),l.jsx("p",{children:"Be the first player to create a winning hand of exactly 4 cards."})]}),l.jsxs("section",{className:"rules-section",children:[l.jsx("h3",{children:"ðŸƒ Winning Hand"}),l.jsx("p",{children:"A winning hand consists of:"}),l.jsxs("ul",{children:[l.jsxs("li",{children:[l.jsx("strong",{children:"One Pair"})," - Two cards of the same rank (e.g., two 8s)"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Two Followers"})," - Two cards in sequential order (e.g., 9 and 10)"]})]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Example:"})," 8â™¥, 8â™ , 9â™£, 10â™¦ (pair of 8s + 9,10 sequence)"]})]}),l.jsxs("section",{className:"rules-section",children:[l.jsx("h3",{children:"ðŸŽ® How to Play"}),l.jsxs("ol",{children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Draw Phase:"})," On your turn, draw one card from the deck"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Discard Phase:"})," Choose one card from your hand to discard"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Win Check:"})," If you have a winning hand, the game ends and you win!"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Continue:"})," Play passes to the next player"]})]})]}),l.jsxs("section",{className:"rules-section",children:[l.jsx("h3",{children:"ðŸ“± Controls"}),l.jsxs("ul",{children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Draw Card:"})," Tap the deck to draw a card"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Select Card:"})," Tap a card in your hand to select it"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Discard:"})," Tap the selected card again to discard it"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Mobile Gestures:"})," Swipe cards left/right to discard quickly"]})]})]}),l.jsxs("section",{className:"rules-section",children:[l.jsx("h3",{children:"ðŸ’¡ Pro Tips"}),l.jsxs("ul",{children:[l.jsx("li",{children:"Watch what other players discard - you might be able to use those cards!"}),l.jsx("li",{children:"Sometimes you can win with just 3 cards if the top discard pile card completes your hand"}),l.jsx("li",{children:"Keep track of which cards have been played to know what's still in the deck"}),l.jsx("li",{children:"Don't hold onto cards too long - be ready to adapt your strategy"})]})]}),l.jsxs("section",{className:"rules-section",children:[l.jsx("h3",{children:"ðŸŽµ Audio & Accessibility"}),l.jsxs("ul",{children:[l.jsx("li",{children:"Sound effects play for all game actions"}),l.jsx("li",{children:"Haptic feedback on mobile devices for better gameplay feel"}),l.jsx("li",{children:"Screen reader compatible with proper ARIA labels"}),l.jsx("li",{children:"Toggle sounds on/off in settings"})]})]}),l.jsxs("section",{className:"rules-section",children:[l.jsx("h3",{children:"ðŸ† Winning"}),l.jsx("p",{children:"The first player to achieve a winning hand wins the game! The winning hand will be displayed for all players to see."})]})]})]}),te=({quitGameToMenu:e,soundsEnabled:n,toggleSounds:s,playSound:t,onShowRules:a,currentPage:o,onGoHome:i})=>{const[c,r]=d.useState(!1),[h,u]=d.useState(!1),m=e=>{t("button"),navigator.vibrate&&navigator.vibrate([40,20,40]),e()},p=()=>{r(!c),u(!1)},y=()=>{u(!h),r(!1)};return l.jsxs("div",{className:"enhanced-bottom-menu",children:[c&&l.jsx("div",{className:"expanded-panel settings-panel",children:l.jsxs("button",{onClick:()=>m(s),className:"panel-button",children:[n?l.jsx(S,{size:20}):l.jsx(E,{size:20}),"Sound ",n?"ON":"OFF"]})}),h&&l.jsx("div",{className:"expanded-panel info-panel",children:l.jsxs("button",{onClick:()=>m(a),className:"panel-button",children:[l.jsx(g,{size:20}),"Rules"]})}),l.jsxs("div",{className:"main-menu-bar",children:[l.jsxs("button",{onClick:()=>m(i),className:"menu-button",children:[l.jsx(v,{size:20}),l.jsx("span",{children:"Home"})]}),l.jsxs("button",{onClick:()=>m(p),className:"menu-button "+(c?"active":""),children:[l.jsx(C,{size:20}),l.jsx("span",{children:"Settings"})]}),l.jsxs("button",{onClick:()=>m(y),className:"menu-button "+(h?"active":""),children:[l.jsx(k,{size:20}),l.jsx("span",{children:"Info"})]}),e&&l.jsx("button",{onClick:()=>m(e),className:"menu-button quit-button",children:l.jsx("span",{children:"Quit"})})]})]})};function ae(){const[e,n]=d.useState("home"),[s,t]=d.useState("Player"),[a,o]=d.useState(4),[i,c]=d.useState(1),[r,h]=d.useState([]),[m,p]=d.useState(null),[y,w]=d.useState(null),[b,j]=d.useState(null),[x,g]=d.useState(null),[f,v]=d.useState(!0),[k,C]=d.useState({drawing:!1,discarding:!1,joining:!1,starting:!1,cpuMoving:!1}),{playSound:N,soundsEnabled:S,toggleSounds:E,enableAudio:P}=(()=>{const[e,n]=d.useState(!0),[s,t]=d.useState(null),a=d.useCallback(async(e,n,a="sine")=>{if("undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext))try{let o=s;o||(o=new(window.AudioContext||window.webkitAudioContext),t(o)),"suspended"===o.state&&await o.resume();const i=o.createOscillator(),c=o.createGain();i.connect(c),c.connect(o.destination),i.frequency.setValueAtTime(e,o.currentTime),i.type=a,c.gain.setValueAtTime(.05,o.currentTime),c.gain.exponentialRampToValueAtTime(.001,o.currentTime+n),i.start(o.currentTime),i.stop(o.currentTime+n)}catch(x){}},[s]),o=d.useMemo(()=>({draw:new u.Howl({src:["/sounds/draw.mp3","/sounds/draw.wav"],volume:.3,html5:!0,onloaderror:()=>{}}),discard:new u.Howl({src:["/sounds/discard.mp3","/sounds/discard.wav"],volume:.4,html5:!0,onloaderror:()=>{}}),win:new u.Howl({src:["/sounds/win.mp3","/sounds/win.wav"],volume:.5,html5:!0,onloaderror:()=>{}}),button:new u.Howl({src:["/sounds/button.mp3","/sounds/button.wav"],volume:.2,html5:!0,onloaderror:()=>{}}),shuffle:new u.Howl({src:["/sounds/shuffle.mp3","/sounds/shuffle.wav"],volume:.3,html5:!0,onloaderror:()=>{}})}),[]),i=d.useCallback(async e=>{try{switch(e){case"draw":await a(800,.2,"sine");break;case"discard":await a(400,.3,"sawtooth");break;case"shuffle":setTimeout(async()=>await a(300,.1,"square"),0),setTimeout(async()=>await a(350,.1,"square"),100),setTimeout(async()=>await a(320,.1,"square"),200);break;case"win":await a(523,.4,"sine"),setTimeout(async()=>await a(659,.4,"sine"),200),setTimeout(async()=>await a(784,.6,"sine"),400);break;case"button":await a(1e3,.1,"square")}}catch(n){}},[a]),c=d.useCallback(async n=>{if(e)try{const e=o[n];if("loaded"===e.state())try{e.play()}catch(s){await i(n)}else await i(n)}catch(x){await i(n)}},[e,o,i]),r=d.useCallback(()=>{n(e=>!e)},[]),l=d.useCallback(async()=>{if("undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext))try{let e=s;e||(e=new(window.AudioContext||window.webkitAudioContext),t(e)),"suspended"===e.state&&await e.resume()}catch(x){}},[s]);return{playSound:c,soundsEnabled:e,toggleSounds:r,enableAudio:l}})();d.useEffect(()=>{const e=async()=>{await P(),document.removeEventListener("touchstart",e),document.removeEventListener("click",e),document.removeEventListener("keydown",e)};return document.addEventListener("touchstart",e,{once:!0}),document.addEventListener("click",e,{once:!0}),document.addEventListener("keydown",e,{once:!0}),()=>{document.removeEventListener("touchstart",e),document.removeEventListener("click",e),document.removeEventListener("keydown",e)}},[P]),d.useEffect(()=>{if(!b||!f)return;let e,n=3,s=2e3;const t=async()=>{try{const t=await fetch(`${H}/game/${b}`);if(!t.ok){if(404===t.status)return g("Game not found or expired. Returning to main menu."),w(null),j(null),void clearInterval(e);throw new Error("Network response was not ok")}const a=await t.json();w(a),n=3,s=2e3}catch(a){n--,s=Math.min(1.5*s,1e4),n<=0?(g("Connection lost. Trying to reconnect..."),clearInterval(e),setTimeout(async()=>{const a=await J();v(a),a&&(s=2e3,e=setInterval(t,s),t()),n=3},5e3)):(clearInterval(e),e=setInterval(t,s))}};return e=setInterval(t,s),t(),()=>clearInterval(e)},[b,f]),d.useEffect(()=>{if(!y||y.game_over||!f)return;const e=y.players[y.current_player],n=e.name===s;if(e?.is_cpu&&!n&&!k.cpuMoving){C(e=>({...e,cpuMoving:!0}));(async()=>{try{await new Promise(e=>setTimeout(e,1e3)),N("draw");const n=await G(y.id);w(n),await new Promise(e=>setTimeout(e,1e3));const s=n.players.find(n=>n.name===e.name);if(s&&s.hand.length>0){const e=Math.floor(Math.random()*s.hand.length);N("discard");const t=await V(n.id,e);w(t)}else{const e=await fetch(`${H}/game/${y.id}`).then(e=>e.json());w(e)}}catch(n){try{const e=await fetch(`${H}/game/${y.id}`).then(e=>e.json());w(e)}catch(s){}}finally{C(e=>({...e,cpuMoving:!1}))}})()}},[y,s,f,k.cpuMoving,N]),d.useEffect(()=>{if("multiplayer"!==e||!f)return;const n=setInterval(()=>{K().then(h).catch(()=>{})},5e3);return()=>clearInterval(n)},[e,f]),d.useEffect(()=>{if(!m||!f)return;const e=setInterval(async()=>{try{const t=await Q(m.id);if(null===t)p(null),g("Lobby disappeared. It might have started or expired. Please check available games."),n("home");else if(t.started&&t.game_id)try{const e=await W(t.game_id,s);p(null),j(e.id),w(e)}catch(e){const s=e instanceof Error?e.message:"Failed to join game after lobby started.";g(s),p(null),n("home")}else p(t)}catch(t){const e=t instanceof Error?t.message:"An unexpected error occurred while fetching lobby details.";g(e)}},3e3);return()=>clearInterval(e)},[m,f,s]);const T=()=>{w(null),j(null),n("home")},R=()=>{n("home")};return l.jsx(U,{baseUrl:"wss://njuka-webapp-backend.onrender.com",children:l.jsxs("div",{className:"App",children:[l.jsx("h1",{children:"Njuka King"}),l.jsx(z,{showControls:!0,showDetails:!0,className:"connection-status-top"}),l.jsx(_,{isOpen:!!x,onClose:()=>g(null),message:x||"",showRetryButton:x?.includes("Connection")||x?.includes("Network")||!1,onRetry:()=>window.location.reload(),retryButtonText:"Retry Connection"}),l.jsx(A,{isVisible:k.starting||k.joining,message:"Connecting to game server..."}),y?l.jsxs("div",{className:"game-container",children:[l.jsx($,{state:y,playerName:s,onDiscard:async e=>{C(e=>({...e,discarding:!0})),g(null);try{if(!y)return;const n=await V(y.id,e);w(n),N("discard")}catch(n){g(n.message||"Failed to discard card")}finally{C(e=>({...e,discarding:!1}))}},onDraw:async()=>{C(e=>({...e,drawing:!0})),g(null);try{if(!y)return;const e=await G(y.id);w(e),N("draw")}catch(e){g(e.message||"Failed to draw card")}finally{C(e=>({...e,drawing:!1}))}},loadingStates:k,playSound:N,showTutorial:"tutorial"===e,onCloseTutorial:R}),l.jsx(M,{isOpen:!!y.game_over,onClose:T,winner:y.winner||"Unknown",winnerHand:y.winner_hand,onNewGame:T})]}):m?l.jsxs("div",{className:"lobby-view",children:[l.jsxs("h2",{children:["Lobby: ",m.id]}),l.jsxs("p",{children:["Host: ",m.host]}),l.jsxs("p",{children:["Players: ",m.players.length,"/",m.max_players]}),l.jsxs("div",{className:"player-list",children:[l.jsx("h3",{children:"Players:"}),l.jsx("ul",{children:m.players.map(e=>l.jsxs("li",{children:[e," ",e===s&&"(You)",e===m.host&&" ðŸ‘‘"]},e))})]}),l.jsx("button",{onClick:()=>p(null),className:"quit-btn",children:"Leave Lobby"})]}):l.jsxs(l.Fragment,{children:["home"===e&&l.jsx(X,{onSelectMode:e=>{"multiplayer"===e?(n("multiplayer"),K().then(h).catch(()=>h([]))):n("cpu")},playerName:s,setPlayerName:t}),"multiplayer"===e&&l.jsx(ee,{onBack:()=>n("home"),playerName:s,numPlayers:a,setNumPlayers:o,onCreateLobby:async()=>{C(e=>({...e,starting:!0})),g(null);try{const e=await Y(s,a);p(e),N("shuffle")}catch(e){g(e.message||"Failed to create lobby")}finally{C(e=>({...e,starting:!1}))}},onJoinLobby:async e=>{C(e=>({...e,joining:!0})),g(null);try{const n=await Z(e,s);p(n),N("draw")}catch(n){g(n.message||"Failed to join lobby")}finally{C(e=>({...e,joining:!1}))}},lobbies:r,loadingStates:k,onRefreshLobbies:()=>{K().then(h).catch(()=>g("Failed to refresh lobbies"))}}),"cpu"===e&&l.jsx(ne,{onBack:()=>n("home"),onStartGame:async()=>{C(e=>({...e,starting:!0})),g(null);try{const e=await q("cpu",s,i);j(e.id),w(e),n("game"),N("shuffle")}catch(e){g(e.message||"Failed to create game")}finally{C(e=>({...e,starting:!1}))}},numCPU:i,setNumCPU:c,loadingStates:k}),"rules"===e&&l.jsx(se,{onBack:()=>n("home")}),"tutorial"===e&&l.jsx(O,{isOpen:!0,onClose:R})]}),l.jsx(te,{quitGameToMenu:y?T:void 0,soundsEnabled:S,toggleSounds:E,playSound:N,onShowRules:()=>{n("rules")},currentPage:e,onGoHome:()=>{n("home"),p(null),w(null),j(null)}})]})})}export{ae as A,L as M,h as R,l as j,d as r};
